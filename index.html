<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - Mundo Carol</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #d63384;
            --primary-dark: #c22574;
            --secondary: #6c757d;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
            --gray: #6c757d;
            --bg-light: #f8f9fa;
            --whatsapp: #25D366;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            padding: 10px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-bottom: 3px solid var(--primary);
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 18px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header p {
            color: var(--gray);
            font-size: 14px;
        }
        
        .products-summary {
            background: linear-gradient(135deg, #e8f5e9 0%, #d4edda 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid var(--success);
        }
        
        .products-summary h3 {
            color: #155724;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .products-list {
            max-height: 150px;
            overflow-y: auto;
            margin: 5px 0;
        }
        
        .product-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #c3e6cb;
            font-size: 13px;
        }
        
        .product-summary-item:last-child {
            border-bottom: none;
        }
        
        .form-page {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-page.active {
            display: block;
        }
        
        .section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .section-title {
            color: var(--primary);
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .section-title i {
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #444;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
            -webkit-appearance: none;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(214, 51, 132, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .radio-group {
            margin: 15px 0;
        }
        
        .radio-group p {
            font-weight: 600;
            margin-bottom: 12px;
            color: #444;
            font-size: 14px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .radio-option:hover {
            border-color: var(--primary);
            background: rgba(214, 51, 132, 0.03);
        }
        
        .radio-option input {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .radio-option label {
            cursor: pointer;
            flex: 1;
            font-size: 15px;
            margin: 0;
            font-weight: 500;
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 13px;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .alert-info {
            background: #e8f4fd;
            border: 1px solid #b6e0fe;
            color: #0c5460;
        }
        
        .btn {
            display: inline-block;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            width: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(214, 51, 132, 0.3);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .btn-whatsapp {
            background: var(--whatsapp);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            padding: 14px;
            margin: 20px 0;
            width: 100%;
        }
        
        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
        }
        
        .btn-disabled {
            background: #adb5bd;
            cursor: not-allowed;
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
            width: auto;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .nav-buttons .btn {
            flex: 1;
        }
        
        .hidden {
            display: none !important;
        }
        
        .calendar-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .calendar-nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .calendar-month-year {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            text-align: center;
            flex: 1;
            order: 2;
        }
        
        .calendar-nav {
            background: white;
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .calendar-nav:hover {
            border-color: var(--primary);
            background: rgba(214, 51, 132, 0.05);
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 8px 0;
            color: var(--gray);
            font-size: 12px;
        }
        
        .calendar-day {
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            position: relative;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calendar-day:hover:not(.disabled) {
            border-color: var(--primary);
            background: rgba(214, 51, 132, 0.05);
        }
        
        .calendar-day.disabled {
            background: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
            border-color: #e9ecef;
        }
        
        .calendar-day.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .calendar-day.no-delivery {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
            cursor: not-allowed;
        }
        
        .calendar-day.special-day {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .calendar-day.special-day:hover:not(.disabled) {
            background: #c3e6cb;
            border-color: var(--primary);
        }
        
        .time-options {
            margin-top: 15px;
        }
        
        .time-option {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .time-option:hover:not(.disabled) {
            border-color: var(--primary);
            background: rgba(214, 51, 132, 0.03);
        }
        
        .time-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .time-option.disabled {
            background: #f8f9fa;
            color: #adb5bd;
            cursor: not-allowed;
            border-color: #e9ecef;
        }
        
        .checkbox-confirm {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid var(--border);
        }
        
        .checkbox-confirm label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            margin: 0;
            font-size: 14px;
        }
        
        .checkbox-confirm input {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .spinner {
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .review-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        .review-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .review-label {
            font-weight: 600;
            color: var(--gray);
            flex: 1;
        }
        
        .review-value {
            font-weight: 500;
            text-align: right;
            flex: 1;
        }
        
        .total-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .total-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ddd;
            font-size: 14px;
        }
        
        .total-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .total-final {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-top: 10px;
        }
        
        .payment-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin: 20px 0;
        }
        
        .pix-key-container {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 15px 0;
            border: 2px dashed var(--primary);
        }
        
        .pix-key {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            margin: 15px 0;
            border: 2px solid var(--border);
            word-break: break-all;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pix-key:hover {
            background: #f8f9fa;
        }
        
        .instructions {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--success);
        }
        
        .instructions h3 {
            color: var(--success);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .success-page {
            text-align: center;
            padding: 20px;
        }
        
        .success-icon {
            font-size: 60px;
            color: var(--success);
            margin-bottom: 15px;
        }
        
        .success-title {
            color: var(--success);
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .success-subtitle {
            color: var(--gray);
            font-size: 16px;
            margin-bottom: 25px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .info-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .info-card h3 {
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .frete-display {
            font-size: 13px;
            color: var(--gray);
            margin-top: 5px;
            text-align: right;
        }
        
        .frete-value {
            font-weight: 600;
            color: var(--success);
        }
        
        .link-generator {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .copy-btn {
            background: var(--secondary);
            color: white;
            margin-top: 10px;
            padding: 10px 15px;
        }
        
        .copy-btn:hover {
            background: #5a6268;
        }
        
        .schedule-info {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .schedule-info h3 {
            color: #856404;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        
        .schedule-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #ffeaa7;
            font-size: 14px;
        }
        
        .schedule-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .link-instructions {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 13px;
            color: #0d47a1;
        }
        
        .multi-method-notice {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 13px;
            color: #856404;
        }
        
        .generated-link-container {
            margin-top: 15px;
        }
        
        .generated-link {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            word-break: break-all;
            font-size: 13px;
            border: 1px solid #dee2e6;
            text-align: left;
            margin-bottom: 10px;
        }
        
        .product-row {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            position: relative;
        }
        
        .product-row:last-child {
            margin-bottom: 0;
        }
        
        .product-row .form-row {
            align-items: flex-end;
        }
        
        .product-row .form-group {
            margin-bottom: 0;
        }
        
        .product-row .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }
        
        .product-locked {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            margin-bottom: 20px;
            position: relative;
        }
        
        .product-locked h3 {
            color: #155724;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .expired-message {
            background-color: #f8d7da;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }
        
        .expired-message h2 {
            color: #721c24;
            margin-bottom: 15px;
        }
        
        .expired-message p {
            color: #721c24;
            margin-bottom: 15px;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .payment-option-header {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
            text-align: center;
        }
        
        .payment-option-header h3 {
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        .whatsapp-discreto {
            background: white;
            border: 2px solid var(--whatsapp);
            color: var(--whatsapp);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 15px auto;
            width: auto;
            min-width: 200px;
            transition: all 0.3s;
        }
        
        .whatsapp-discreto:hover {
            background: var(--whatsapp);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
        }
        
        .copy-success {
            color: var(--success);
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        
        .copy-success.show {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .taxa-item {
            color: #dc3545;
            font-weight: 600;
        }
        
        .taxa-label {
            color: #dc3545;
        }
        
        .toast-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-notification.success {
            background: var(--success);
        }
        
        .toast-notification.warning {
            background: var(--warning);
            color: #333;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-left: auto;
        }
        
        .field-error {
            border-color: var(--danger) !important;
            background-color: #fff5f5 !important;
        }
        
        .error-text {
            color: var(--danger);
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-text.show {
            display: block;
        }
        
        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 5px;
        }
        
        .progress-step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #dee2e6;
            transition: all 0.3s;
        }
        
        .progress-step.active {
            background: var(--primary);
            transform: scale(1.2);
        }
        
        .progress-step.completed {
            background: var(--success);
        }
        
        .clear-all-btn {
            background: var(--danger);
            color: white;
            margin-top: 10px;
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            width: auto;
            min-width: 180px;
        }
        
        .clear-all-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .clear-section {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
        }
        
        .anonymous-notes {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #6c757d;
        }
        
        .anonymous-notes h4 {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .anonymous-notes ul {
            margin-left: 20px;
            margin-bottom: 10px;
            font-size: 13px;
            color: #666;
        }
        
        .anonymous-notes li {
            margin-bottom: 5px;
        }
        
        .terms-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed #dee2e6;
            text-align: center;
        }
        
        .terms-box label {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--primary);
        }
        
        .terms-box input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }
        
        .autosave-indicator {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: var(--success);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
            animation: fadeIn 0.3s;
        }
        
        .autosave-indicator.show {
            display: flex;
        }
        
        .obrigatorio-small {
            font-size: 11px;
            color: var(--danger);
            font-weight: normal;
            margin-left: 5px;
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 16px;
            }
            
            .form-page {
                padding: 15px;
            }
            
            .calendar-day {
                padding: 8px 0;
                font-size: 12px;
                min-height: 35px;
            }
            
            .calendar-nav-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .calendar-nav {
                order: 3;
                margin-top: 5px;
            }
            
            .calendar-month-year {
                order: 1;
            }
            
            .pix-key {
                font-size: 16px;
                padding: 12px;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 15px;
            }
            
            .nav-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .nav-buttons .btn {
                min-width: 120px;
            }
            
            .review-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .review-label, .review-value {
                text-align: left;
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .products-summary {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .product-row .form-row {
                flex-direction: column;
            }
            
            .product-row .form-group {
                width: 100%;
            }
            
            .toast-notification {
                left: 10px;
                right: 10px;
                bottom: 10px;
                max-width: none;
            }
            
            .autosave-indicator {
                bottom: 60px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 700px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Mensagem de Link Expirado -->
        <div id="expiredMessage" class="expired-message hidden">
            <h2><i class="fas fa-exclamation-triangle"></i> Link Expirado</h2>
            <p>Este link de pedido expirou ou j√° foi utilizado.</p>
            <p>Entre em contato com o atendente para receber um novo link.</p>
            <button class="whatsapp-discreto" onclick="contactWhatsApp()">
                <i class="fab fa-whatsapp"></i> WhatsApp: (31) 98323-8087
            </button>
        </div>
        
        <!-- Cabe√ßalho -->
        <div id="mainHeader" class="header">
            <h1><i class="fas fa-calendar-alt"></i> Agendamento Mundo Carol</h1>
        </div>
        
        <!-- Resumo dos Produtos (sempre vis√≠vel no topo) -->
        <div id="productsSummary" class="products-summary">
            <h3><i class="fas fa-box"></i> Produtos do Pedido</h3>
            <div id="productsList" class="products-list">
                <!-- Os produtos ser√£o carregados aqui -->
            </div>
        </div>
        
        <!-- Indicador de Progresso -->
        <div class="progress-indicator" id="progressIndicator">
            <div class="progress-step active" id="step1"></div>
            <div class="progress-step" id="step2"></div>
            <div class="progress-step" id="step3"></div>
            <div class="progress-step" id="step4"></div>
            <div class="progress-step" id="step5"></div>
            <div class="progress-step" id="step6"></div>
        </div>
        
        <!-- Notifica√ß√£o Toast -->
        <div id="toastNotification" class="toast-notification hidden">
            <i class="fas fa-exclamation-circle"></i>
            <span id="toastMessage"></span>
            <button class="toast-close" onclick="closeToast()">&times;</button>
        </div>
        
        <!-- P√°gina 1: Produtos e Dados B√°sicos -->
        <div id="page1" class="form-page active">
            <!-- Se√ß√£o de Produtos (s√≥ aparece quando N√ÉO veio de link) -->
            <div class="section" id="productSection">
                <div class="section-title">
                    <span><i class="fas fa-box"></i> Produtos do Pedido</span>
                    <button type="button" class="btn btn-primary btn-small" id="addProductBtn">
                        <i class="fas fa-plus"></i> Adicionar Produto
                    </button>
                </div>
                
                <div class="alert alert-info">
                    <p><strong>Frete ser√° calculado ap√≥s escolha do seu endere√ßo e aparecer√° ao final para confer√™ncia.</strong></p>
                </div>
                
                <div id="productsContainer">
                    <!-- Primeira linha de produto -->
                    <div class="product-row" id="productRow1">
                        <button class="remove-btn" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="form-row">
                            <div class="form-group" style="flex: 0.5;">
                                <label for="productQuantity1">Qtde</label>
                                <input type="number" id="productQuantity1" class="form-control product-quantity" min="1" value="1">
                            </div>
                            <div class="form-group" style="flex: 0.8;">
                                <label for="productCode1">C√≥digo</label>
                                <input type="text" id="productCode1" class="form-control product-code" placeholder="Ex: 060">
                            </div>
                            <div class="form-group" style="flex: 2;">
                                <label for="productName1">Descri√ß√£o <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                                <input type="text" id="productName1" class="form-control product-name" placeholder="Descri√ß√£o do produto" required>
                                <div class="error-text" id="errorProductName1"></div>
                            </div>
                            <div class="form-group" style="flex: 1;">
                                <label for="productPrice1">Pre√ßo (R$) <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                                <input type="number" id="productPrice1" class="form-control product-price" min="0" step="0.01" placeholder="0,00" required>
                                <div class="error-text" id="errorProductPrice1"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bot√£o Limpar Tudo (s√≥ aparece quando n√£o veio de link) -->
                <div id="clearAllSection" class="clear-section">
                    <button type="button" class="clear-all-btn" id="clearAllBtn">
                        <i class="fas fa-trash-alt"></i> Limpar Todos os Dados
                    </button>
                    <p style="font-size: 12px; color: #666; margin-top: 8px;">
                        Apaga produtos e todos os dados preenchidos
                    </p>
                </div>
                
                <!-- Gerador de Link (s√≥ aparece quando n√£o veio de link) -->
                <div id="linkGeneratorSection">
                    <div class="link-instructions">
                        <p><strong>üìã Para enviar para cliente:</strong> Preencha os produtos e clique em "Gerar Link"</p>
                    </div>
                    <button type="button" class="btn btn-primary" id="generateLinkBtn">Gerar Link para Cliente</button>
                    
                    <div id="generatedLinkContainer" class="generated-link-container hidden">
                        <div class="multi-method-notice">
                            <p><strong>üéØ Link para enviar ao cliente:</strong></p>
                            <p>O cliente receber√° os produtos j√° pr√©-selecionados e n√£o poder√° alter√°-los.</p>
                            <p><strong>Validade:</strong> 24 horas ou at√© ser usado</p>
                        </div>
                        
                        <h3 class="section-title">Link Gerado:</h3>
                        <div id="generatedLink" class="generated-link"></div>
                        <button type="button" id="copyLinkBtn" class="btn copy-btn">Copiar Link</button>
                        
                        <div class="alert alert-warning" style="margin-top: 15px;">
                            <p><strong>Instru√ß√µes:</strong></p>
                            <p>1. O link foi copiado automaticamente</p>
                            <p>2. Envie para seu cliente via WhatsApp ou outro app</p>
                            <p>3. O link √© v√°lido por 24 horas ou at√© ser usado</p>
                            <p>4. O cliente ver√° produtos j√° preenchidos</p>
                            <p>5. Ele s√≥ precisar√° completar seus dados e endere√ßo</p>
                        </div>
                        
                        <p class="copy-success" id="copySuccess">‚úÖ Link copiado automaticamente!</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-user"></i> Dados do Comprador</h2>
                
                <div class="form-group">
                    <label for="buyerName">Nome do Comprador: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                    <input type="text" id="buyerName" class="form-control" required>
                    <div class="error-text" id="errorBuyerName"></div>
                </div>
                
                <div class="form-group">
                    <label for="buyerPhone">Telefone: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                    <input type="text" id="buyerPhone" class="form-control" placeholder="Ex: (31) 98323-8087 ou 31983238087" required>
                    <small style="color: #666; font-size: 12px;">Qualquer formato de telefone √© aceito</small>
                    <div class="error-text" id="errorBuyerPhone"></div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-user-check"></i> Dados do Presenteado</h2>
                
                <div class="alert alert-warning">
                    <p><strong>Aten√ß√£o:</strong> Preencha nome e telefone da pessoa presenteada apenas se a entrega do presente for para ela. Se a entrega do presente for para voc√™ (comprador), repita seus dados. N√£o queremos estragar surpresas!</p>
                </div>
                
                <div class="form-group">
                    <label for="giftedName">Nome da Pessoa Presenteada: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                    <input type="text" id="giftedName" class="form-control" required>
                    <div class="error-text" id="errorGiftedName"></div>
                </div>
                
                <div class="form-group">
                    <label for="giftedPhone">Telefone do Presenteado: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                    <input type="text" id="giftedPhone" class="form-control" placeholder="Ex: (31) 98323-8087 ou 31983238087" required>
                    <small style="color: #666; font-size: 12px;">Qualquer formato de telefone √© aceito</small>
                    <div class="error-text" id="errorGiftedPhone"></div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-truck"></i> Tipo de Entrega <span class="obrigatorio-small">(obrigat√≥rio)</span></h2>
                <div class="radio-group">
                    <p>Confirme se ser√° entrega ou Retirada na Loja</p>
                    <div class="radio-option">
                        <input type="radio" name="deliveryType" id="delivery" value="delivery">
                        <label for="delivery">Quero que envie para o endere√ßo que vou fornecer</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="deliveryType" id="pickup" value="pickup">
                        <label for="pickup">Vou retirar na loja (Bairro S√£o Geraldo - BH)</label>
                    </div>
                </div>
                <div class="error-text" id="errorDeliveryType"></div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage1" disabled><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="nextPage1">Pr√≥xima <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- P√°gina 2: Endere√ßo -->
        <div id="page2" class="form-page">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-map-marker-alt"></i> Endere√ßo de Entrega</h2>
                
                <div class="form-group">
                    <label for="deliveryCity">Para qual cidade enviaremos seu pedido? <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                    <select id="deliveryCity" class="form-control" required>
                        <option value="">Selecione sua cidade</option>
                        <option value="Belo Horizonte">Belo Horizonte</option>
                        <option value="Betim">Betim</option>
                        <option value="Contagem">Contagem</option>
                        <option value="Sabar√°">Sabar√°</option>
                        <option value="Ibirit√©">Ibirit√©</option>
                        <option value="Ribeir√£o das Neves">Ribeir√£o das Neves</option>
                        <option value="Santa Luzia">Santa Luzia</option>
                        <option value="Vespasiano">Vespasiano</option>
                        <option value="Lagoa Santa">Lagoa Santa</option>
                        <option value="Nova Lima">Nova Lima</option>
                        <option value="Nova Lima (Vila da Serra)">Nova Lima (Vila da Serra)</option>
                        <option value="other">Outra Localidade ou Cidade</option>
                    </select>
                    <div class="error-text" id="errorDeliveryCity"></div>
                    <div id="shippingInfo" class="frete-display hidden">
                        <span>Frete: <span id="freteValue" class="frete-value"></span></span>
                    </div>
                </div>
                
                <div id="addressFields">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="street">Rua: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                            <input type="text" id="street" class="form-control" placeholder="Ex: Rua das Flores" required>
                            <div class="error-text" id="errorStreet"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="number">N√∫mero: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                            <input type="text" id="number" class="form-control" placeholder="Ex: 123" required>
                            <div class="error-text" id="errorNumber"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="complement">Complemento (ap/bloco/loja/etc):</label>
                        <input type="text" id="complement" class="form-control">
                        <small>Se n√£o tem complemento, pode deixar em branco</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="neighborhood">Bairro: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                        <input type="text" id="neighborhood" class="form-control" required>
                        <div class="error-text" id="errorNeighborhood"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="referencePoint">Ponto de refer√™ncia ou CEP (n√£o √© obrigat√≥rio):</label>
                        <input type="text" id="referencePoint" class="form-control" placeholder="Ex: Pr√≥ximo ao supermercado X ou 30130-000">
                    </div>
                </div>
                
                <div id="otherCityMessage" class="alert alert-info hidden">
                    <h3><i class="fas fa-truck-loading"></i> Entrega para Outra Cidade</h3>
                    <p>Ao escolher <strong>Outra Localidade ou Cidade</strong>, por n√£o ser entrega pr√≥pria o prazo ser√° informado por um de nossos atendentes.</p>
                    <p>Os envios s√£o feitos por Correios e Transportadoras, portanto temos prazos aproximados, mas n√£o temos entregas agendadas.</p>
                    <p>Ap√≥s a confirma√ß√£o do pagamento, nossa equipe entrar√° em contato para informar o prazo de entrega estimado.</p>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage2"><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="nextPage2">Pr√≥xima <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- P√°gina 3: Calend√°rio -->
        <div id="page3" class="form-page">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Data de Entrega/Retirada <span class="obrigatorio-small">(obrigat√≥rio)</span></h2>
                
                <div id="calendarContainer" class="calendar-container">
                    <div class="calendar-nav-container">
                        <span class="calendar-nav" id="prevMonth"><i class="fas fa-chevron-left"></i> M√™s Anterior</span>
                        <span id="currentMonthYear" class="calendar-month-year"></span>
                        <span class="calendar-nav" id="nextMonth">Pr√≥ximo M√™s <i class="fas fa-chevron-right"></i></span>
                    </div>
                    <div id="calendar" class="calendar"></div>
                </div>
                
                <div id="noDeliveryMessage" class="alert alert-warning hidden">
                    <p><strong>Nesse dia n√£o teremos entregas.</strong> Selecione outro dia para conseguir agendar seu pedido.</p>
                    <button type="button" class="btn btn-secondary" id="resetCalendarBtn">Voltar para op√ß√µes</button>
                </div>
                
                <div id="timeOptions" class="time-options hidden">
                    <h3 class="section-title"><i class="fas fa-clock"></i> Hor√°rios Dispon√≠veis <span class="obrigatorio-small">(obrigat√≥rio)</span></h3>
                    <div id="deliveryOptionsContainer"></div>
                    <div class="error-text" id="errorDeliveryTime"></div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage3"><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="nextPage3">Pr√≥xima <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- P√°gina 4: Cart√£o de Mensagem -->
        <div id="page4" class="form-page">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-envelope"></i> Cart√£o de Mensagem <span class="obrigatorio-small">(obrigat√≥rio)</span></h2>
                
                <div class="radio-group">
                    <p>Gostaria de Enviar um Cart√£o? (Sem custo adicional)</p>
                    <div class="radio-option">
                        <input type="radio" name="sendCard" value="yes" id="sendCardYes">
                        <label for="sendCardYes">Sim, quero enviar um cart√£o</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="sendCard" value="no" id="sendCardNo">
                        <label for="sendCardNo">N√£o, n√£o quero cart√£o</label>
                    </div>
                </div>
                <div class="error-text" id="errorSendCard"></div>
                
                <!-- Se√ß√£o que aparece quando N√ÉO quer cart√£o -->
                <div id="noCardSection" class="hidden">
                    <div class="radio-group">
                        <p>Sua compra √© Normal? Seu nome pode aparecer? <span class="obrigatorio-small">(obrigat√≥rio)</span></p>
                        <div class="radio-option">
                            <input type="radio" name="anonymousNoCard" id="anonymousNoNoCard" value="no" checked>
                            <label for="anonymousNoNoCard">Sim, sem problemas (nome aparecendo)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="anonymousNoCard" id="anonymousYesNoCard" value="yes">
                            <label for="anonymousYesNoCard">Quero uma compra An√¥nima</label>
                        </div>
                    </div>
                    <div class="error-text" id="errorAnonymousNoCard"></div>
                    
                    <div id="anonymousNotesNoCard" class="anonymous-notes hidden">
                        <h4><i class="fas fa-info-circle"></i> Observa√ß√µes importantes para compra an√¥nima:</h4>
                        <ul>
                            <li>Informe todas as particularidades para que n√£o tenha falhas na entrega</li>
                            <li>Como ser√° feita a identifica√ß√£o no endere√ßo?</li>
                            <li>Alguma informa√ß√£o especial que o entregador deve saber?</li>
                            <li>Como o presenteado saber√° quem enviou?</li>
                        </ul>
                        <div class="form-group">
                            <label for="anonymousNotesTextNoCard">Observa√ß√µes do anonimato: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                            <textarea id="anonymousNotesTextNoCard" class="form-control" rows="3" placeholder="Descreva todas as informa√ß√µes necess√°rias para uma entrega perfeita..."></textarea>
                            <div class="error-text" id="errorAnonymousNotesNoCard"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o que aparece quando QUER cart√£o -->
                <div id="cardMessageSection" class="hidden">
                    <div class="form-group">
                        <label for="cardMessage">Escreva o Texto do seu Cart√£o: (n√£o esque√ßa de assinar caso n√£o seja an√¥nimo) <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                        <textarea id="cardMessage" class="form-control" rows="5" placeholder="Digite sua mensagem aqui..."></textarea>
                        <div class="error-text" id="errorCardMessage"></div>
                    </div>
                    
                    <div class="radio-group">
                        <p>Voc√™ lembrou de assinar seu cart√£o na mensagem acima? <span class="obrigatorio-small">(obrigat√≥rio)</span></p>
                        <div class="radio-option">
                            <input type="radio" name="signedCard" value="yes" id="signedCardYes">
                            <label for="signedCardYes">Sei que a assinatura deve constar no final da mensagem acima preenchida, e se eu n√£o colocar √© porque realmente n√£o quero minha assinatura</label>
                        </div>
                    </div>
                    <div class="error-text" id="errorSignedCard"></div>
                    
                    <div class="radio-group">
                        <p>Sua compra √© Normal? Seu nome pode aparecer? <span class="obrigatorio-small">(obrigat√≥rio)</span></p>
                        <div class="radio-option">
                            <input type="radio" name="anonymous" id="anonymousNo" value="no" checked>
                            <label for="anonymousNo">Sim, sem problemas (nome aparecendo)</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" name="anonymous" id="anonymousYes" value="yes">
                            <label for="anonymousYes">Quero uma compra An√¥nima</label>
                        </div>
                    </div>
                    <div class="error-text" id="errorAnonymous"></div>
                    
                    <div id="anonymousNotes" class="anonymous-notes hidden">
                        <h4><i class="fas fa-info-circle"></i> Observa√ß√µes importantes para compra an√¥nima:</h4>
                        <ul>
                            <li>Informe todas as particularidades para que n√£o tenha falhas na entrega</li>
                            <li>Como ser√° feita a identifica√ß√£o no endere√ßo?</li>
                            <li>Alguma informa√ß√£o especial que o entregador deve saber?</li>
                            <li>Como o presenteado saber√° quem enviou?</li>
                        </ul>
                        <div class="form-group">
                            <label for="anonymousNotesText">Observa√ß√µes do anonimato: <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                            <textarea id="anonymousNotesText" class="form-control" rows="3" placeholder="Descreva todas as informa√ß√µes necess√°rias para uma entrega perfeita..."></textarea>
                            <div class="error-text" id="errorAnonymousNotes"></div>
                        </div>
                    </div>
                    
                    <div class="terms-box">
                        <label>
                            <input type="radio" name="acknowledgeTerms" value="yes" id="acknowledgeTermsYes">
                            Termo de Ci√™ncia <span class="obrigatorio-small">(obrigat√≥rio)</span>
                        </label>
                        <p style="margin-top: 10px; font-size: 13px; color: #666;">
                            Todas as mensagens para o cart√£o n√£o podem ser corrigidas ou alteradas, por se tratar de algo particular. <strong>Ent√£o se atente √† gram√°tica.</strong>
                        </p>
                    </div>
                    <div class="error-text" id="errorAcknowledgeTerms"></div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage4"><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="nextPage4">Pr√≥xima <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- P√°gina 5: Pagamento -->
        <div id="page5" class="form-page">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-credit-card"></i> Forma de Pagamento <span class="obrigatorio-small">(obrigat√≥rio)</span></h2>
                
                <div class="radio-group">
                    <p>Como gostaria de finalizar o pagamento do seu pedido?</p>
                    <div class="radio-option">
                        <input type="radio" name="paymentMethod" value="pix" id="paymentPix">
                        <label for="paymentPix">PIX direto para nosso CNPJ (Libera√ß√£o imediata)</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="paymentMethod" value="creditCard" id="paymentCreditCard">
                        <label for="paymentCreditCard">Link de Cart√£o de Cr√©dito online (enviaremos o link)</label>
                    </div>
                </div>
                <div class="error-text" id="errorPaymentMethod"></div>
            </div>
            
            <div class="section">
                <h2 class="section-title"><i class="fas fa-search"></i> Como nos encontrou? <span class="obrigatorio-small">(obrigat√≥rio)</span></h2>
                
                <div class="radio-group">
                    <p>Nos ajude a melhorar cada vez mais!</p>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="google" id="foundUsGoogle">
                        <label for="foundUsGoogle">Google</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="instagram" id="foundUsInstagram">
                        <label for="foundUsInstagram">Instagram</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="facebook" id="foundUsFacebook">
                        <label for="foundUsFacebook">Facebook</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="indicacao" id="foundUsIndicacao">
                        <label for="foundUsIndicacao">Indica√ß√£o de amigo/familiar</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="cliente_antigo" id="foundUsClienteAntigo">
                        <label for="foundUsClienteAntigo">J√° sou cliente antigo</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" name="foundUs" value="outro" id="foundUsOutro">
                        <label for="foundUsOutro">Outro</label>
                    </div>
                </div>
                <div class="error-text" id="errorFoundUs"></div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage5"><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="nextPage5">Revisar e Enviar <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        
        <!-- P√°gina 6: Revis√£o -->
        <div id="page6" class="form-page">
            <div class="section">
                <h2 class="section-title"><i class="fas fa-clipboard-check"></i> Revise seu Pedido</h2>
                
                <div id="reviewData"></div>
                
                <div id="finalTotalSection" class="total-section hidden">
                    <h3 class="section-title"><i class="fas fa-receipt"></i> Resumo Financeiro</h3>
                    <div id="finalTotalDetails"></div>
                </div>
                
                <div class="alert alert-info">
                    <p><strong>Ap√≥s enviar seus dados, aparecer√£o as informa√ß√µes para pagamento.</strong></p>
                </div>
                
                <!-- Status de Envio -->
                <div class="loading" id="loadingSection">
                    <div class="spinner"></div>
                    <p>Enviando dados para Mundo Carol...</p>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevPage6"><i class="fas fa-arrow-left"></i> Anterior</button>
                <button type="button" class="btn btn-primary" id="submitButton">Enviar Pedido <i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        
        <!-- P√°gina de Sucesso para PIX -->
        <div id="thankYouPagePix" class="form-page">
            <div class="success-page">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                
                <h1 class="success-title">PEDIDO ENVIADO COM SUCESSO!</h1>
                <p class="success-subtitle">Seus dados foram registrados e enviados para nossa equipe. Agora √© s√≥ finalizar o pagamento!</p>
                
                <div class="payment-details">
                    <h2 class="section-title"><i class="fas fa-qrcode"></i> Pagamento via PIX</h2>
                    
                    <div class="pix-key-container">
                        <p>Para pagamento imediato, utilize nossa chave PIX (CNPJ):</p>
                        <div class="pix-key" id="pixKey">10648303000179</div>
                        <button type="button" class="btn btn-primary" id="copyPixKeyBtn">
                            <i class="fas fa-copy"></i> Copiar Chave PIX
                        </button>
                        <p class="copy-success" id="pixCopySuccess"></p>
                    </div>
                    
                    <div id="paymentSummary" class="info-card">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Resumo do Pedido</h3>
                        <div id="paymentDetails"></div>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-info-circle"></i> Pr√≥ximos passos:</h3>
                        <p>1. Realize o pagamento via PIX</p>
                        <p>2. Envie o comprovante para nosso WhatsApp</p>
                        <p>3. Sua entrega ser√° agendada conforme selecionado</p>
                        <p>4. Acompanhe o status pelo WhatsApp</p>
                    </div>
                    
                    <!-- Bot√£o WhatsApp -->
                    <button class="whatsapp-discreto" id="whatsappPixBtn">
                        <i class="fab fa-whatsapp"></i> WhatsApp: (31) 98323-8087
                    </button>
                    
                    <div class="schedule-info">
                        <h3><i class="fas fa-clock"></i> Hor√°rio de Atendimento</h3>
                        <div class="schedule-item">
                            <span class="schedule-day">Segunda a Sexta:</span>
                            <span class="schedule-time">07:30 √†s 17:30</span>
                        </div>
                        <div class="schedule-item">
                            <span class="schedule-day">S√°bado e Feriados:</span>
                            <span class="schedule-time">07:30 √†s 12:00</span>
                        </div>
                        <div class="schedule-item">
                            <span class="schedule-day">Domingo:</span>
                            <span class="schedule-time">N√£o temos atendimentos aos domingos, apenas entregas das cestas encomendadas at√© s√°bado 12 horas</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- P√°gina de Sucesso para Cart√£o -->
        <div id="thankYouPageCard" class="form-page">
            <div class="success-page">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                
                <h1 class="success-title">PEDIDO ENVIADO COM SUCESSO!</h1>
                <p class="success-subtitle">Seus dados foram registrados e enviados para nossa equipe. Agora √© s√≥ solicitar o link de pagamento!</p>
                
                <div class="payment-details">
                    <!-- Mensagem para pagamento via cart√£o -->
                    <div class="payment-option-header">
                        <h3><i class="fas fa-credit-card"></i> Voc√™ escolheu pagamento via Link de Cart√£o</h3>
                        <p>Para receber seu link, clique abaixo e j√° solicite ao seu atendente</p>
                        <button class="whatsapp-discreto" id="whatsappCardBtn" style="margin-top: 15px;">
                            <i class="fab fa-whatsapp"></i> Solicitar Link de Cart√£o
                        </button>
                    </div>
                    
                    <div class="pix-key-container" style="margin-top: 30px;">
                        <h3><i class="fas fa-qrcode"></i> Ou prefira pagar via PIX agora mesmo:</h3>
                        <p>Para pagamento imediato, utilize nossa chave PIX (CNPJ):</p>
                        <div class="pix-key" id="pixKey2">10648303000179</div>
                        <button type="button" class="btn btn-primary" id="copyPixKeyBtn2">
                            <i class="fas fa-copy"></i> Copiar Chave PIX
                        </button>
                        <p class="copy-success" id="pixCopySuccess2"></p>
                    </div>
                    
                    <div id="paymentSummaryCard" class="info-card">
                        <h3><i class="fas fa-file-invoice-dollar"></i> Resumo do Pedido</h3>
                        <div id="paymentDetailsCard"></div>
                    </div>
                    
                    <div class="info-card">
                        <h3><i class="fas fa-info-circle"></i> Pr√≥ximos passos:</h3>
                        <p>1. Solicite o link de cart√£o via WhatsApp OU pague via PIX</p>
                        <p>2. Envie o comprovante para nosso WhatsApp</p>
                        <p>3. Sua entrega ser√° agendada conforme selecionado</p>
                        <p>4. Acompanhe o status pelo WhatsApp</p>
                    </div>
                    
                    <div class="schedule-info">
                        <h3><i class="fas fa-clock"></i> Hor√°rio de Atendimento</h3>
                        <div class="schedule-item">
                            <span class="schedule-day">Segunda a Sexta:</span>
                            <span class="schedule-time">07:30 √†s 17:30</span>
                        </div>
                        <div class="schedule-item">
                            <span class="schedule-day">S√°bado e Feriados:</span>
                            <span class="schedule-time">07:30 √†s 12:00</span>
                        </div>
                        <div class="schedule-item">
                            <span class="schedule-day">Domingo:</span>
                            <span class="schedule-time">N√£o temos atendimentos aos domingos, apenas entregas das cestas encomendadas at√© s√°bado 12 horas</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ïES DO SISTEMA
        // ============================================
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwAM8V_xQ8uxdcmfANaeKTgUDRZtZI9tcXOnm0ou0mnUWwsh3GOT5WJk9GztSiQevEN/exec';
        const CORRECT_PASSWORD = '562938';
        const PIX_KEY = '10648303000179';
        const WHATSAPP_NUMBER = '5531983238087';
        
        // ============================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================
        let selectedDate = null;
        let selectedTime = null;
        let selectedTimeLabel = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let nightFeeAmount = 0;
        let isOtherCity = false;
        let calculatedShipping = 0;
        let selectedCity = '';
        let isSubmitting = false;
        let currentDeliveryType = '';
        
        // IMPORTANTE: Controla se veio de link (produto bloqueado)
        let isFromLink = false;
        let lockedProducts = [];
        let linkId = null;
        
        // Sistema de m√∫ltiplos produtos
        let productRows = 1;
        
        // ============================================
        // TABELA DE FRETES ATUALIZADA
        // ============================================
        const shippingRates = {
            'Belo Horizonte': [
                { min: 1, max: 119.99, cost: 19.90 },
                { min: 120, max: 178.99, cost: 14.90 },
                { min: 179, max: 99999, cost: 0.00 }
            ],
            'Betim': [
                { min: 1, max: 119.99, cost: 69.90 },
                { min: 120, max: 178.99, cost: 54.90 },
                { min: 179, max: 99999, cost: 44.90 }
            ],
            'Contagem': [
                { min: 1, max: 119.99, cost: 29.90 },
                { min: 120, max: 178.99, cost: 24.90 },
                { min: 179, max: 99999, cost: 19.90 }
            ],
            'Sabar√°': [
                { min: 1, max: 119.99, cost: 29.90 },
                { min: 120, max: 178.99, cost: 26.90 },
                { min: 179, max: 99999, cost: 22.90 }
            ],
            'Ibirit√©': [
                { min: 1, max: 119.99, cost: 69.90 },
                { min: 120, max: 178.99, cost: 59.90 },
                { min: 179, max: 99999, cost: 44.90 }
            ],
            'Ribeir√£o das Neves': [
                { min: 1, max: 119.99, cost: 59.90 },
                { min: 120, max: 178.99, cost: 54.90 },
                { min: 179, max: 99999, cost: 44.90 }
            ],
            'Santa Luzia': [
                { min: 1, max: 119.99, cost: 49.90 },
                { min: 120, max: 178.99, cost: 44.90 },
                { min: 179, max: 99999, cost: 39.90 }
            ],
            'Vespasiano': [
                { min: 1, max: 119.99, cost: 59.90 },
                { min: 120, max: 178.99, cost: 49.90 },
                { min: 179, max: 99999, cost: 39.90 }
            ],
            'Lagoa Santa': [
                { min: 1, max: 119.99, cost: 59.90 },
                { min: 120, max: 178.99, cost: 54.90 },
                { min: 179, max: 99999, cost: 44.90 }
            ],
            'Nova Lima': [
                { min: 1, max: 119.99, cost: 69.90 },
                { min: 120, max: 178.99, cost: 59.90 },
                { min: 179, max: 99999, cost: 49.90 }
            ],
            'Nova Lima (Vila da Serra)': [
                { min: 1, max: 119.99, cost: 39.90 },
                { min: 120, max: 178.99, cost: 29.90 },
                { min: 179, max: 99999, cost: 19.90 }
            ]
        };
        
        // ============================================
        // CONFIGURA√á√ÉO DE DIAS ESPECIAIS
        // ============================================
        // Aqui voc√™ pode configurar dias especiais, feriados e dias sem entrega
        
        // 1. DIAS SEM ENTREGA - datas em que N√ÉO haver√° entrega nenhuma
        const noDeliveryDates = [
            '2024-12-25', // Natal
            '2024-12-31', // R√©veillon (tarde)
            '2025-01-01', // Ano Novo
            '2025-04-21', // Tiradentes
            '2025-05-01', // Dia do Trabalho
            '2025-09-07', // Independ√™ncia
            '2025-10-12', // Nossa Senhora
            '2025-11-02', // Finados
            '2025-11-15', // Proclama√ß√£o Rep√∫blica
            '2026-01-26', // ano novo
            // Adicione mais datas conforme necess√°rio
        ];
        
        // 2. FERIADOS COM HOR√ÅRIOS ESPECIAIS
        // Formato: 'YYYY-MM-DD': { tipo: 'feriado', horarios: [...] }
        const specialDates = {
            // Exemplo: V√©spera de Natal (meio expediente)
            '2025-12-24': {
                tipo: 'feriado',
                descricao: 'V√©spera de Natal',
                horarios: [
                    { start: '07:30', end: '10:30', label: '07:30 √†s 10:30' },
                    { start: '09:30', end: '11:30', label: '09:30 √†s 11:30' },
                    { start: '13:30', end: '15:30', label: '13:30 √†s 15:30' },
                    { start: '15:30', end: '17:30', label: '15:30 √†s 17:30' },
                    { start: '18:30', end: '20:30', label: '18:30 √†s 20:30' }
                ]
            },
            
            // Exemplo: Dia das M√£es (hor√°rio especial)
            '2025-12-25': {
                tipo: 'feriado',
                descricao: 'Natal',
                horarios: [
                    { start: '07:30', end: '11:30', label: '07:30 √†s 11:30' }
                ]
            },
            
            // Exemplo: Sexta-feira Santa
            '2026-01-02': {
                tipo: 'feriado',
                descricao: 'Sexta-feira Santa',
                horarios: [
                    { start: '09:00', end: '11:30', label: '09:00 √†s 11:30' },
                    { start: '13:00', end: '15:00', label: '13:00 √†s 15:00' }
                ]
            },
            
            // Exemplo: Carnaval
            '2024-12-26': {
                tipo: 'feriado',
                descricao: 'Carnaval',
                horarios: [
                    { start: '08:00', end: '10:00', label: '08:00 √†s 10:00' },
                    { start: '10:00', end: '12:00', label: '10:00 √†s 12:00' }
                ]
            },
            
            // Exemplo: Dia dos Namorados
            '2025-06-12': {
                tipo: 'feriado',
                descricao: 'Dia dos Namorados',
                horarios: [
                    { start: '07:00', end: '09:00', label: '07:00 √†s 09:00' },
                    { start: '09:00', end: '11:00', label: '09:00 √†s 11:00' },
                    { start: '11:00', end: '13:00', label: '11:00 √†s 13:00' },
                    { start: '13:00', end: '15:00', label: '13:00 √†s 15:00' },
                    { start: '15:00', end: '17:00', label: '15:00 √†s 17:00' },
                    { start: '19:00', end: '21:00', label: '19:00 √†s 21:00 (taxa noturna adicional 19,90)', nightFee: true, fee: 19.90 }
                ]
            },
            
            // Exemplo: Dia das Crian√ßas
            '2025-10-12': {
                tipo: 'feriado',
                descricao: 'Dia das Crian√ßas',
                horarios: [
                    { start: '08:00', end: '10:00', label: '08:00 √†s 10:00' },
                    { start: '10:00', end: '12:00', label: '10:00 √†s 12:00' },
                    { start: '12:00', end: '14:00', label: '12:00 √†s 14:00' },
                    { start: '14:00', end: '16:00', label: '14:00 √†s 16:00' }
                ]
            },
            
            // 3. DIAS AT√çPICOS (n√£o s√£o feriados, mas t√™m hor√°rios diferentes)
            // Exemplo: Black Friday
            '2024-11-29': {
                tipo: 'atipico',
                descricao: 'Black Friday',
                horarios: [
                    { start: '07:30', end: '09:30', label: '07:30 √†s 09:30' },
                    { start: '09:30', end: '11:30', label: '09:30 √†s 11:30' },
                    { start: '13:30', end: '15:30', label: '13:30 √†s 15:30' },
                    { start: '15:30', end: '17:30', label: '15:30 √†s 17:30' },
                    { start: '17:30', end: '19:30', label: '17:30 √†s 19:30 (taxa noturna adicional 19,90)', nightFee: true, fee: 19.90 },
                    { start: '19:30', end: '21:30', label: '19:30 √†s 21:30 (taxa noturna adicional 19,90)', nightFee: true, fee: 19.90 }
                ]
            },
            
            // Exemplo: V√©spera de Ano Novo
            '2024-12-31': {
                tipo: 'atipico',
                descricao: 'V√©spera de Ano Novo',
                horarios: [
                    { start: '07:30', end: '09:30', label: '07:30 √†s 09:30' },
                    { start: '09:30', end: '11:30', label: '09:30 √†s 11:30' }
                ]
            }
        };
        
        // ============================================
        // HOR√ÅRIOS REGULARES
        // ============================================
        const routeTimes = {
            weekday: [
                { start: '07:30', end: '09:30', label: '07:30 √†s 09:30' },
                { start: '09:30', end: '11:30', label: '09:30 √†s 11:30' },
                { start: '13:30', end: '15:30', label: '13:30 √†s 15:30' },
                { start: '15:30', end: '17:30', label: '15:30 √†s 17:30' },
                { start: '19:30', end: '21:30', label: '19:30 √†s 21:30 (taxa noturna adicional 19,90)', nightFee: true, fee: 19.90 }
            ],
            saturday: [
                { start: '07:30', end: '10:30', label: '07:30 √†s 10:30' },
                { start: '10:30', end: '12:30', label: '10:30 √†s 12:30' },
                { start: '12:30', end: '16:30', label: '12:30 √†s 16:30' }
            ],
            sunday: [
                { start: '08:00', end: '10:00', label: '08:00 √†s 10:00 (taxa adicional 19,90)', sundayFee: true, fee: 19.90 }
            ]
        };
        
        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sistema de Agendamento - Mundo Carol');
            
            // Verificar se veio de link (DEVE SER A PRIMEIRA COISA)
            checkIfFromLink();
            
            // Configurar todos os event listeners
            setupEventListeners();
            
            // Carregar dados salvos
            loadFormData();
            
            // Renderizar calend√°rio inicial
            renderCalendar(currentMonth, currentYear);
            
            // Configurar bot√µes de cart√£o
            setupCardSection();
            
            // Atualizar resumo inicial
            updateProductsSummary();
            
            // Configurar AUTOSAVE SILENCIOSO
            setupSilentAutosave();
            
            console.log('‚úÖ Sistema carregado. Modo:', isFromLink ? 'LINK' : 'FLUXO NORMAL');
        });
        
        // ============================================
        // CONFIGURA√á√ÉO DE EVENT LISTENERS
        // ============================================
        function setupEventListeners() {
            // Bot√µes de navega√ß√£o
            document.getElementById('addProductBtn').addEventListener('click', addProductRow);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllData);
            document.getElementById('generateLinkBtn').addEventListener('click', generateClientLink);
            document.getElementById('copyLinkBtn').addEventListener('click', copyLinkAgain);
            
            // Navega√ß√£o entre p√°ginas
            document.getElementById('nextPage1').addEventListener('click', () => nextPage(1, 2));
            document.getElementById('prevPage2').addEventListener('click', () => prevPage(2, 1));
            document.getElementById('nextPage2').addEventListener('click', () => nextPage(2, 3));
            document.getElementById('prevPage3').addEventListener('click', () => prevPage(3, 2));
            document.getElementById('nextPage3').addEventListener('click', () => nextPage(3, 4));
            document.getElementById('prevPage4').addEventListener('click', () => prevPage(4, 3));
            document.getElementById('nextPage4').addEventListener('click', () => nextPage(4, 5));
            document.getElementById('prevPage5').addEventListener('click', () => prevPage(5, 4));
            document.getElementById('nextPage5').addEventListener('click', () => nextPage(5, 6));
            document.getElementById('prevPage6').addEventListener('click', () => prevPage(6, 5));
            document.getElementById('submitButton').addEventListener('click', submitForm);
            
            // Calend√°rio
            document.getElementById('prevMonth').addEventListener('click', prevMonth);
            document.getElementById('nextMonth').addEventListener('click', nextMonth);
            document.getElementById('resetCalendarBtn').addEventListener('click', resetCalendar);
            
            // Tipo de entrega (para calcular frete)
            document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentDeliveryType = this.value;
                    updateCityDisplay();
                    handleSilentAutosave();
                });
            });
            
            // Cidade (para calcular frete)
            document.getElementById('deliveryCity').addEventListener('change', function() {
                selectedCity = this.value;
                isOtherCity = this.value === 'other';
                updateCityDisplay();
                handleSilentAutosave();
            });
            
            // P√°ginas de sucesso
            document.getElementById('copyPixKeyBtn').addEventListener('click', copyPixKey);
            document.getElementById('copyPixKeyBtn2').addEventListener('click', copyPixKey);
            document.getElementById('whatsappPixBtn').addEventListener('click', () => sendWhatsAppMessage('pix'));
            document.getElementById('whatsappCardBtn').addEventListener('click', () => sendWhatsAppMessage('card'));
            
            // Campos de formul√°rio para autosave
            setupFormInputListeners();
        }
        
        function setupFormInputListeners() {
            // Inputs de produtos
            document.querySelectorAll('.product-quantity, .product-code, .product-name, .product-price').forEach(input => {
                input.addEventListener('input', updateProductsSummary);
                input.addEventListener('change', handleSilentAutosave);
            });
            
            // Outros inputs
            document.querySelectorAll('#buyerName, #buyerPhone, #giftedName, #giftedPhone, #street, #number, #complement, #neighborhood, #referencePoint, #cardMessage, #anonymousNotesText, #anonymousNotesTextNoCard').forEach(input => {
                input.addEventListener('input', handleSilentAutosave);
                input.addEventListener('change', handleSilentAutosave);
            });
            
            // Radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', handleSilentAutosave);
            });
            
            // Radio buttons espec√≠ficos
            document.querySelectorAll('input[name="sendCard"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const cardSection = document.getElementById('cardMessageSection');
                    const noCardSection = document.getElementById('noCardSection');
                    
                    if (this.value === 'yes') {
                        cardSection.classList.remove('hidden');
                        noCardSection.classList.add('hidden');
                    } else {
                        cardSection.classList.add('hidden');
                        noCardSection.classList.remove('hidden');
                    }
                    handleSilentAutosave();
                });
            });
            
            document.querySelectorAll('input[name="anonymous"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const anonymousNotes = document.getElementById('anonymousNotes');
                    if (this.value === 'yes') {
                        anonymousNotes.classList.remove('hidden');
                    } else {
                        anonymousNotes.classList.add('hidden');
                    }
                    handleSilentAutosave();
                });
            });
            
            document.querySelectorAll('input[name="anonymousNoCard"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const anonymousNotes = document.getElementById('anonymousNotesNoCard');
                    if (this.value === 'yes') {
                        anonymousNotes.classList.remove('hidden');
                    } else {
                        anonymousNotes.classList.add('hidden');
                    }
                    handleSilentAutosave();
                });
            });
        }
        
        // ============================================
        // SISTEMA DE AUTOSAVE SILENCIOSO
        // ============================================
        function handleSilentAutosave() {
            clearTimeout(window.autosaveTimeout);
            window.autosaveTimeout = setTimeout(() => {
                saveFormData();
            }, 1000);
        }
        
        function saveFormData() {
            try {
                const storageKey = isFromLink ? 'mundoCarolFormData_link' : 'mundoCarolFormData';
                
                const { products } = getAllProducts();
                
                const formData = {
                    timestamp: new Date().toISOString(),
                    isFromLink: isFromLink,
                    linkProducts: isFromLink ? lockedProducts : [],
                    linkId: linkId,
                    
                    // Dados pessoais
                    buyerName: document.getElementById('buyerName')?.value || '',
                    buyerPhone: document.getElementById('buyerPhone')?.value || '',
                    giftedName: document.getElementById('giftedName')?.value || '',
                    giftedPhone: document.getElementById('giftedPhone')?.value || '',
                    
                    // Endere√ßo
                    deliveryType: document.querySelector('input[name="deliveryType"]:checked')?.value || '',
                    deliveryCity: document.getElementById('deliveryCity')?.value || '',
                    street: document.getElementById('street')?.value || '',
                    number: document.getElementById('number')?.value || '',
                    complement: document.getElementById('complement')?.value || '',
                    neighborhood: document.getElementById('neighborhood')?.value || '',
                    referencePoint: document.getElementById('referencePoint')?.value || '',
                    
                    // Cart√£o
                    sendCard: document.querySelector('input[name="sendCard"]:checked')?.value || '',
                    cardMessage: document.getElementById('cardMessage')?.value || '',
                    anonymous: document.querySelector('input[name="anonymous"]:checked')?.value || 
                              document.querySelector('input[name="anonymousNoCard"]:checked')?.value || '',
                    anonymousNotes: document.getElementById('anonymousNotesText')?.value || 
                                   document.getElementById('anonymousNotesTextNoCard')?.value || '',
                    signedCard: document.querySelector('input[name="signedCard"]:checked')?.value || '',
                    acknowledgeTerms: document.querySelector('input[name="acknowledgeTerms"]:checked')?.value || '',
                    
                    // Outros
                    paymentMethod: document.querySelector('input[name="paymentMethod"]:checked')?.value || '',
                    foundUs: document.querySelector('input[name="foundUs"]:checked')?.value || '',
                    
                    // Calend√°rio
                    selectedDate: selectedDate ? selectedDate.toISOString() : null,
                    selectedTime: selectedTime || '',
                    selectedTimeLabel: selectedTimeLabel || '',
                    
                    // Valores calculados
                    selectedCity: selectedCity,
                    calculatedShipping: calculatedShipping,
                    nightFeeAmount: nightFeeAmount,
                    currentDeliveryType: currentDeliveryType,
                    
                    // Produtos
                    products: products,
                    productRows: productRows
                };
                
                // P√°gina atual
                const activePage = document.querySelector('.form-page.active');
                formData.currentPage = activePage ? activePage.id.replace('page', '') : '1';
                
                // Salvar no localStorage
                localStorage.setItem(storageKey, JSON.stringify(formData));
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados:', error);
            }
        }
        
        function loadFormData() {
            try {
                const storageKey = isFromLink ? 'mundoCarolFormData_link' : 'mundoCarolFormData';
                const savedData = localStorage.getItem(storageKey);
                
                if (!savedData) return;
                
                const data = JSON.parse(savedData);
                console.log('üìÇ Carregando dados salvos de:', data.timestamp);
                
                // Restaurar dados b√°sicos
                if (data.buyerName) document.getElementById('buyerName').value = data.buyerName;
                if (data.buyerPhone) document.getElementById('buyerPhone').value = data.buyerPhone;
                if (data.giftedName) document.getElementById('giftedName').value = data.giftedName;
                if (data.giftedPhone) document.getElementById('giftedPhone').value = data.giftedPhone;
                
                // Restaurar endere√ßo
                if (data.deliveryCity) document.getElementById('deliveryCity').value = data.deliveryCity;
                if (data.street) document.getElementById('street').value = data.street;
                if (data.number) document.getElementById('number').value = data.number;
                if (data.complement) document.getElementById('complement').value = data.complement;
                if (data.neighborhood) document.getElementById('neighborhood').value = data.neighborhood;
                if (data.referencePoint) document.getElementById('referencePoint').value = data.referencePoint;
                
                // Restaurar cart√£o
                if (data.cardMessage) document.getElementById('cardMessage').value = data.cardMessage;
                if (data.anonymousNotes) {
                    document.getElementById('anonymousNotesText').value = data.anonymousNotes;
                    document.getElementById('anonymousNotesTextNoCard').value = data.anonymousNotes;
                }
                
                // Restaurar produtos (apenas se n√£o for de link)
                if (!isFromLink && data.products && Array.isArray(data.products)) {
                    // Limpar produtos existentes (exceto o primeiro)
                    const container = document.getElementById('productsContainer');
                    while (container.children.length > 1) {
                        container.removeChild(container.lastChild);
                    }
                    
                    productRows = 1;
                    
                    // Recriar produtos a partir do segundo
                    for (let i = 1; i < data.products.length; i++) {
                        addProductRow();
                        const product = data.products[i];
                        
                        document.getElementById(`productQuantity${i+1}`).value = product.quantity;
                        document.getElementById(`productCode${i+1}`).value = product.code || '';
                        document.getElementById(`productName${i+1}`).value = product.name;
                        document.getElementById(`productPrice${i+1}`).value = product.price;
                    }
                    
                    updateRemoveButtons();
                }
                
                // Restaurar radios
                restoreRadio('deliveryType', data.deliveryType);
                restoreRadio('sendCard', data.sendCard);
                restoreRadio('anonymous', data.anonymous);
                restoreRadio('anonymousNoCard', data.anonymous);
                restoreRadio('signedCard', data.signedCard);
                restoreRadio('acknowledgeTerms', data.acknowledgeTerms);
                restoreRadio('paymentMethod', data.paymentMethod);
                restoreRadio('foundUs', data.foundUs);
                
                // Restaurar vari√°veis
                selectedCity = data.selectedCity || '';
                calculatedShipping = data.calculatedShipping || 0;
                nightFeeAmount = data.nightFeeAmount || 0;
                currentDeliveryType = data.currentDeliveryType || '';
                
                // Atualizar display da cidade
                updateCityDisplay();
                
                // Atualizar resumo
                updateProductsSummary();
                
                // Restaurar calend√°rio
                if (data.selectedDate) {
                    selectedDate = new Date(data.selectedDate);
                    selectedTime = data.selectedTime;
                    selectedTimeLabel = data.selectedTimeLabel;
                    
                    // Atualizar calend√°rio visualmente
                    if (selectedDate) {
                        currentMonth = selectedDate.getMonth();
                        currentYear = selectedDate.getFullYear();
                        renderCalendar(currentMonth, currentYear);
                        
                        // Selecionar a data no calend√°rio
                        setTimeout(() => {
                            selectDate(selectedDate);
                        }, 500);
                    }
                }
                
                // Mostrar/ocultar se√ß√µes conforme dados
                if (data.sendCard === 'yes') {
                    document.getElementById('cardMessageSection').classList.remove('hidden');
                    document.getElementById('noCardSection').classList.add('hidden');
                } else if (data.sendCard === 'no') {
                    document.getElementById('cardMessageSection').classList.add('hidden');
                    document.getElementById('noCardSection').classList.remove('hidden');
                }
                
                if (data.anonymous === 'yes') {
                    document.getElementById('anonymousNotes').classList.remove('hidden');
                    document.getElementById('anonymousNotesNoCard').classList.remove('hidden');
                }
                
                // Restaurar p√°gina atual
                if (data.currentPage && data.currentPage !== '1') {
                    setTimeout(() => {
                        navigateToPage(parseInt(data.currentPage));
                    }, 300);
                }
                
                console.log('‚úÖ Dados carregados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
            }
        }
        
        function restoreRadio(name, value) {
            if (!value) return;
            
            const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (radio) {
                radio.checked = true;
                // Disparar evento change para atualizar UI
                const event = new Event('change');
                radio.dispatchEvent(event);
            }
        }
        
        // ============================================
        // FUN√á√ïES DOS BOT√ïES
        // ============================================
        function addProductRow() {
            productRows++;
            const container = document.getElementById('productsContainer');
            
            const newRow = document.createElement('div');
            newRow.className = 'product-row';
            newRow.id = `productRow${productRows}`;
            
            newRow.innerHTML = `
                <button class="remove-btn">
                    <i class="fas fa-times"></i>
                </button>
                <div class="form-row">
                    <div class="form-group" style="flex: 0.5;">
                        <label for="productQuantity${productRows}">Qtde</label>
                        <input type="number" id="productQuantity${productRows}" class="form-control product-quantity" min="1" value="1">
                    </div>
                    <div class="form-group" style="flex: 0.8;">
                        <label for="productCode${productRows}">C√≥digo</label>
                        <input type="text" id="productCode${productRows}" class="form-control product-code" placeholder="Ex: 060">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label for="productName${productRows}">Descri√ß√£o <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                        <input type="text" id="productName${productRows}" class="form-control product-name" placeholder="Descri√ß√£o do produto" required>
                        <div class="error-text" id="errorProductName${productRows}"></div>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="productPrice${productRows}">Pre√ßo (R$) <span class="obrigatorio-small">(obrigat√≥rio)</span></label>
                        <input type="number" id="productPrice${productRows}" class="form-control product-price" min="0" step="0.01" placeholder="0,00" required>
                        <div class="error-text" id="errorProductPrice${productRows}"></div>
                    </div>
                </div>
            `;
            
            container.appendChild(newRow);
            updateRemoveButtons();
            updateProductsSummary();
            
            // Adicionar event listeners aos novos inputs
            const removeBtn = newRow.querySelector('.remove-btn');
            removeBtn.addEventListener('click', () => removeProductRow(`productRow${productRows}`));
            
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updateProductsSummary);
                input.addEventListener('change', handleSilentAutosave);
            });
        }
        
        function removeProductRow(rowId) {
            const row = document.getElementById(rowId);
            if (row && productRows > 1) {
                row.remove();
                productRows--;
                updateRemoveButtons();
                updateProductsSummary();
                handleSilentAutosave();
            }
        }
        
        function updateRemoveButtons() {
            const rows = document.querySelectorAll('.product-row');
            const removeButtons = document.querySelectorAll('.remove-btn');
            
            removeButtons.forEach(btn => {
                btn.style.display = rows.length > 1 ? 'block' : 'none';
            });
        }
        
        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Isso apagar√° todos os produtos e informa√ß√µes preenchidas.')) {
                // Limpar localStorage
                const storageKey = isFromLink ? 'mundoCarolFormData_link' : 'mundoCarolFormData';
                localStorage.removeItem(storageKey);
                
                // Recarregar a p√°gina
                location.reload();
            }
        }
        
        // ============================================
        // NAVEGA√á√ÉO ENTRE P√ÅGINAS
        // ============================================
        function nextPage(current, next) {
            clearErrors();
            
            let validationResult = validatePage(current);
            if (!validationResult.valid) {
                showErrors(validationResult.errors);
                showToast('Preencha todos os campos obrigat√≥rios', 'warning');
                return;
            }
            
            // SALVAR antes de mudar de p√°gina
            saveFormData();
            
            // Atualizar progresso
            updateProgress(current, next);
            
            // Ir para pr√≥xima p√°gina
            document.getElementById(`page${current}`).classList.remove('active');
            document.getElementById(`page${next}`).classList.add('active');
            
            // Atualizar revis√£o na √∫ltima p√°gina
            if (next === 6) {
                updateReviewData();
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function prevPage(current, prev) {
            // SALVAR antes de mudar de p√°gina
            saveFormData();
            
            document.getElementById(`page${current}`).classList.remove('active');
            document.getElementById(`page${prev}`).classList.add('active');
            updateProgress(current, prev, false);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function navigateToPage(pageNumber) {
            if (pageNumber < 1 || pageNumber > 6) return;
            
            // Esconder todas as p√°ginas
            document.querySelectorAll('.form-page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Mostrar p√°gina desejada
            document.getElementById(`page${pageNumber}`).classList.add('active');
            
            // Atualizar progresso
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            for (let i = 1; i < pageNumber; i++) {
                document.getElementById(`step${i}`).classList.add('completed');
            }
            document.getElementById(`step${pageNumber}`).classList.add('active');
        }
        
        function updateProgress(current, next, forward = true) {
            const steps = document.querySelectorAll('.progress-step');
            
            if (forward) {
                // Marcar atual como completado e pr√≥xima como ativa
                steps[current - 1].classList.add('completed');
                steps[current - 1].classList.remove('active');
                if (next <= steps.length) {
                    steps[next - 1].classList.add('active');
                }
            } else {
                // Voltar: remover completado da atual
                steps[current - 1].classList.remove('completed');
                steps[current - 1].classList.remove('active');
                steps[prev - 1].classList.add('active');
            }
        }
        
        // ============================================
        // CALEND√ÅRIO COM DIAS ESPECIAIS
        // ============================================
        function prevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentMonth, currentYear);
            handleSilentAutosave();
        }
        
        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentMonth, currentYear);
            handleSilentAutosave();
        }
        
        function renderCalendar(month, year) {
            const calendar = document.getElementById('calendar');
            const monthYearDisplay = document.getElementById('currentMonthYear');
            
            calendar.innerHTML = '';
            
            const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                              "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            monthYearDisplay.textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            for (let i = 0; i < 7; i++) {
                const dayHeader = document.createElement('div');
                dayHeader.classList.add('calendar-day-header');
                dayHeader.textContent = weekdays[i];
                calendar.appendChild(dayHeader);
            }
            
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('calendar-day', 'disabled');
                calendar.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('calendar-day');
                dayElement.textContent = day;
                
                const currentDate = new Date(year, month, day);
                const dateString = formatDateForComparison(currentDate);
                
                // Verificar se √© dia sem entrega
                if (noDeliveryDates.includes(dateString)) {
                    dayElement.classList.add('no-delivery');
                    dayElement.classList.add('disabled');
                    dayElement.title = 'Dia sem entrega';
                }
                // Verificar se √© dia especial (feriado ou at√≠pico)
                else if (specialDates[dateString]) {
                    dayElement.classList.add('special-day');
                    const specialInfo = specialDates[dateString];
                    dayElement.title = `${specialInfo.descricao} - Hor√°rios especiais`;
                }
                // Dias normais que j√° passaram
                else if (currentDate < today) {
                    dayElement.classList.add('disabled');
                }
                
                if (!dayElement.classList.contains('disabled') && !dayElement.classList.contains('no-delivery')) {
                    dayElement.addEventListener('click', function() {
                        selectDate(currentDate);
                    });
                }
                
                if (selectedDate && 
                    selectedDate.getDate() === day && 
                    selectedDate.getMonth() === month && 
                    selectedDate.getFullYear() === year) {
                    dayElement.classList.add('selected');
                }
                
                calendar.appendChild(dayElement);
            }
        }
        
        function formatDateForComparison(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function selectDate(date) {
            const dateString = formatDateForComparison(date);
            
            // Verificar se √© dia sem entrega
            if (noDeliveryDates.includes(dateString)) {
                document.getElementById('noDeliveryMessage').classList.remove('hidden');
                document.getElementById('timeOptions').classList.add('hidden');
                return;
            }
            
            selectedDate = date;
            document.getElementById('noDeliveryMessage').classList.add('hidden');
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            const days = document.querySelectorAll('.calendar-day');
            days.forEach(day => {
                if (parseInt(day.textContent) === date.getDate() && !isNaN(parseInt(day.textContent))) {
                    day.classList.add('selected');
                }
            });
            
            const dayOfWeek = date.getDay();
            const optionsContainer = document.getElementById('deliveryOptionsContainer');
            optionsContainer.innerHTML = '';
            
            selectedTime = null;
            selectedTimeLabel = null;
            nightFeeAmount = 0;
            
            const today = new Date();
            const isToday = date.getDate() === today.getDate() && 
                           date.getMonth() === today.getMonth() && 
                           date.getFullYear() === today.getFullYear();
            
            const now = new Date();
            const currentHour = now.getHours();
            let routes = [];
            let routeType = '';
            
            // Verificar se √© dia especial
            if (specialDates[dateString]) {
                const specialDay = specialDates[dateString];
                routes = specialDay.horarios;
                routeType = specialDay.tipo;
                
                // Adicionar descri√ß√£o especial
                const specialHeader = document.createElement('div');
                specialHeader.className = 'alert alert-info';
                specialHeader.innerHTML = `<p><strong>${specialDay.descricao}:</strong> Hor√°rios especiais para este dia.</p>`;
                optionsContainer.appendChild(specialHeader);
            }
            // Dias normais
            else if (dayOfWeek === 0) {
                routes = routeTimes.sunday;
                routeType = 'sunday';
            } else if (dayOfWeek === 6) {
                routes = routeTimes.saturday;
                routeType = 'saturday';
            } else {
                routes = routeTimes.weekday;
                routeType = 'weekday';
            }
            
            // Filtrar hor√°rios passados se for hoje
            routes = routes.filter(route => {
                let isRouteAvailable = true;
                
                if (isToday) {
                    const [startHour, startMinute] = route.start.split(':').map(Number);
                    const startTimeInMinutes = startHour * 60 + startMinute;
                    const currentTimeInMinutes = currentHour * 60 + now.getMinutes();
                    const timeUntilStart = startTimeInMinutes - currentTimeInMinutes;
                    
                    if (timeUntilStart < 30) {
                        isRouteAvailable = false;
                    }
                }
                
                return isRouteAvailable;
            });
            
            if (routes.length === 0) {
                const noTimesMessage = document.createElement('div');
                noTimesMessage.className = 'alert alert-warning';
                noTimesMessage.textContent = 'N√£o h√° mais hor√°rios dispon√≠veis para hoje. Selecione outra data.';
                optionsContainer.appendChild(noTimesMessage);
            } else {
                routes.forEach((route, index) => {
                    const routeId = `time${routeType}${index + 1}`;
                    const routeElement = document.createElement('div');
                    routeElement.classList.add('time-option');
                    
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = 'deliveryTime';
                    input.id = routeId;
                    input.value = `${route.start}-${route.end}`;
                    input.dataset.label = route.label;
                    input.dataset.nightfee = route.nightFee || false;
                    input.dataset.fee = route.fee || 0;
                    input.dataset.sundayfee = route.sundayFee || false;
                    
                    const label = document.createElement('label');
                    label.htmlFor = routeId;
                    label.textContent = route.label;
                    label.style.cursor = 'pointer';
                    label.style.marginLeft = '10px';
                    label.style.flex = '1';
                    
                    const container = document.createElement('div');
                    container.style.display = 'flex';
                    container.style.alignItems = 'center';
                    container.appendChild(input);
                    container.appendChild(label);
                    routeElement.appendChild(container);
                    
                    input.addEventListener('change', function() {
                        selectedTime = this.value;
                        selectedTimeLabel = this.getAttribute('data-label');
                        
                        const hasNightFee = this.getAttribute('data-nightfee') === 'true';
                        const hasSundayFee = this.getAttribute('data-sundayfee') === 'true';
                        const feeAmount = parseFloat(this.getAttribute('data-fee')) || 0;
                        
                        nightFeeAmount = 0;
                        
                        if (hasNightFee || hasSundayFee) {
                            nightFeeAmount = feeAmount;
                        }
                        
                        handleSilentAutosave();
                    });
                    
                    optionsContainer.appendChild(routeElement);
                });
            }
            
            document.getElementById('timeOptions').classList.remove('hidden');
            handleSilentAutosave();
        }
        
        function resetCalendar() {
            document.getElementById('noDeliveryMessage').classList.add('hidden');
            document.getElementById('timeOptions').classList.add('hidden');
            selectedDate = null;
            selectedTime = null;
            selectedTimeLabel = null;
            nightFeeAmount = 0;
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            handleSilentAutosave();
        }
        
        // ============================================
        // FUN√á√ïES DE DISPLAY
        // ============================================
        function updateCityDisplay() {
            const otherCityMessage = document.getElementById('otherCityMessage');
            const shippingInfo = document.getElementById('shippingInfo');
            const addressFields = document.getElementById('addressFields');
            
            if (isOtherCity) {
                otherCityMessage.classList.remove('hidden');
                shippingInfo.classList.add('hidden');
                addressFields.style.display = 'none';
                calculatedShipping = 0;
                document.getElementById('freteValue').textContent = 'A combinar';
            } else {
                otherCityMessage.classList.add('hidden');
                addressFields.style.display = 'block';
                
                if (selectedCity && currentDeliveryType === 'delivery') {
                    shippingInfo.classList.remove('hidden');
                    calculateShipping();
                } else {
                    shippingInfo.classList.add('hidden');
                }
            }
        }
        
        function calculateShipping() {
            const { total } = getAllProducts();
            const cityRates = shippingRates[selectedCity];
            
            if (cityRates && total > 0) {
                for (const rate of cityRates) {
                    if (total >= rate.min && total <= rate.max) {
                        calculatedShipping = rate.cost;
                        document.getElementById('freteValue').textContent = `R$ ${rate.cost.toFixed(2).replace('.', ',')}`;
                        break;
                    }
                }
            } else {
                calculatedShipping = 0;
                document.getElementById('freteValue').textContent = 'R$ 0,00';
            }
            
            handleSilentAutosave();
        }
        
        // ============================================
        // FUN√á√ïES DE PRODUTOS
        // ============================================
        function getAllProducts() {
            const products = [];
            let total = 0;
            
            // Se veio de link, usa os produtos bloqueados
            if (isFromLink && lockedProducts.length > 0) {
                return { products: lockedProducts, total: lockedProducts.reduce((sum, p) => sum + (p.quantity * p.price), 0) };
            }
            
            // Se n√£o veio de link, l√™ os produtos do formul√°rio
            for (let i = 1; i <= productRows; i++) {
                const quantity = parseInt(document.getElementById(`productQuantity${i}`)?.value) || 0;
                const code = document.getElementById(`productCode${i}`)?.value || '';
                const name = document.getElementById(`productName${i}`)?.value || '';
                const price = parseFloat(document.getElementById(`productPrice${i}`)?.value) || 0;
                
                if (name && price > 0) {
                    products.push({
                        quantity,
                        code,
                        name,
                        price,
                        total: quantity * price
                    });
                    total += quantity * price;
                }
            }
            
            return { products, total };
        }
        
        function updateProductsSummary() {
            const { products, total } = getAllProducts();
            
            // Atualizar resumo SEMPRE (para ambos os modos)
            updateProductsSummaryDisplay(products);
            
            // Calcular frete se necess√°rio
            if (selectedCity && selectedCity !== 'other' && currentDeliveryType === 'delivery') {
                calculateShipping();
            }
            
            handleSilentAutosave();
        }
        
        function updateProductsSummaryDisplay(products) {
            const productsList = document.getElementById('productsList');
            
            if (products.length > 0) {
                let html = '';
                let totalGeral = 0;
                
                products.forEach((product, index) => {
                    const produtoTotal = product.quantity * product.price;
                    totalGeral += produtoTotal;
                    
                    html += `
                        <div class="product-summary-item">
                            <span>${product.quantity}x ${product.code ? product.code + ' - ' : ''}${product.name}</span>
                            <span>R$ ${produtoTotal.toFixed(2).replace('.', ',')}</span>
                        </div>
                    `;
                });
                
                // Adicionar linha do total
                html += `
                    <div class="product-summary-item" style="border-top: 2px solid #28a745; margin-top: 8px; padding-top: 10px; font-weight: bold;">
                        <span>TOTAL</span>
                        <span>R$ ${totalGeral.toFixed(2).replace('.', ',')}</span>
                    </div>
                `;
                
                productsList.innerHTML = html;
                
                // Garantir que o resumo esteja vis√≠vel
                document.getElementById('productsSummary').classList.remove('hidden');
            } else {
                productsList.innerHTML = '<div class="product-summary-item">Nenhum produto selecionado</div>';
                document.getElementById('productsSummary').classList.remove('hidden');
            }
        }
        
        // ============================================
        // GERADOR DE LINKS
        // ============================================
        function generateClientLink() {
            const { products, total } = getAllProducts();
            
            if (products.length === 0) {
                showToast('Adicione pelo menos um produto antes de gerar o link', 'warning');
                return;
            }
            
            // Gerar ID √∫nico para o link (usando timestamp como ID)
            linkId = Date.now().toString();
            
            // Codificar produtos
            const encodedProducts = encodeProductsForLink(products);
            
            // Criar URL
            const baseUrl = window.location.origin + window.location.pathname;
            const clientLink = `${baseUrl}?p=${encodedProducts}&id=${linkId}`;
            
            // Mostrar link
            document.getElementById('generatedLink').textContent = clientLink;
            document.getElementById('generatedLinkContainer').classList.remove('hidden');
            
            // Copiar automaticamente
            copyToClipboard(clientLink, 'link');
            
            // Mostrar mensagem
            const copySuccess = document.getElementById('copySuccess');
            copySuccess.textContent = '‚úÖ Link copiado automaticamente!';
            copySuccess.classList.add('show');
            
            setTimeout(() => {
                copySuccess.classList.remove('show');
            }, 5000);
            
            showToast('‚úÖ Link gerado e copiado com sucesso!', 'success');
        }
        
        function encodeProductsForLink(products) {
            // Formato: quantidade|codigo|nome|pre√ßo-quantidade|codigo|nome|pre√ßo
            let encoded = '';
            
            products.forEach((product, index) => {
                if (index > 0) encoded += '-';
                
                // Nome do produto (codificar espa√ßos e caracteres especiais)
                const encodedName = encodeURIComponent(product.name);
                
                // Montar parte: quantidade|codigo|nome|pre√ßo
                encoded += `${product.quantity}|${product.code || ''}|${encodedName}|${product.price.toFixed(2)}`;
            });
            
            return encoded;
        }
        
        function decodeProductsFromLink(encodedData) {
            const products = [];
            const productParts = encodedData.split('-');
            
            productParts.forEach(part => {
                const [quantityStr, code, encodedName, priceStr] = part.split('|');
                
                const quantity = parseInt(quantityStr);
                const name = decodeURIComponent(encodedName);
                const price = parseFloat(priceStr);
                
                if (quantity && name && price) {
                    products.push({
                        quantity,
                        code: code || '',
                        name,
                        price,
                        total: quantity * price
                    });
                }
            });
            
            return products;
        }
        
        function copyLinkAgain() {
            const link = document.getElementById('generatedLink').textContent;
            if (link) {
                copyToClipboard(link, 'link');
                const copySuccess = document.getElementById('copySuccess');
                copySuccess.textContent = '‚úÖ Link copiado novamente!';
                copySuccess.classList.add('show');
                
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 3000);
            }
        }
        
        // ============================================
        // LINK COMPARTILHADO
        // ============================================
        function checkIfFromLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const productsData = urlParams.get('p');
            linkId = urlParams.get('id');
            
            console.log('üîç Verificando URL:', { productsData, linkId });
            
            if (productsData && linkId) {
                // Verificar se j√° foi usado (salvamos IDs usados no localStorage)
                const usedLinks = JSON.parse(localStorage.getItem('mundoCarol_used_links') || '[]');
                if (usedLinks.includes(linkId)) {
                    console.log('‚ùå Link j√° usado:', linkId);
                    showExpiredMessage();
                    return;
                }
                
                // Verificar se expirou (24 horas)
                if (linkId) {
                    const linkTime = parseInt(linkId);
                    const now = Date.now();
                    const hoursDiff = (now - linkTime) / (1000 * 60 * 60);
                    
                    console.log('‚è∞ Verificando expira√ß√£o:', { linkTime, now, hoursDiff });
                    
                    if (hoursDiff > 24) {
                        console.log('‚ùå Link expirado (mais de 24 horas):', hoursDiff);
                        showExpiredMessage();
                        return;
                    }
                }
                
                // Marcar como v√°lido
                sessionStorage.setItem('current_session_link', 'valid');
                isFromLink = true;
                
                // Decodificar produtos
                try {
                    console.log('üì¶ Decodificando produtos:', productsData);
                    lockedProducts = decodeProductsFromLink(productsData);
                    console.log('‚úÖ Produtos decodificados:', lockedProducts);
                    
                    sessionStorage.setItem('link_products', productsData);
                    sessionStorage.setItem('link_id', linkId);
                    setupFromLink();
                    
                } catch (error) {
                    console.error('‚ùå Erro ao decodificar produtos:', error);
                    showExpiredMessage();
                }
                
            } else {
                sessionStorage.removeItem('current_session_link');
                console.log('üìù Modo normal (n√£o veio de link)');
            }
        }
        
        function setupFromLink() {
            console.log('üìå Configurando modo LINK:', lockedProducts);
            
            // Ocultar bot√£o de adicionar produto e se√ß√£o de produtos
            document.getElementById('productSection').style.display = 'none';
            document.getElementById('linkGeneratorSection').style.display = 'none';
            document.getElementById('clearAllSection').style.display = 'none';
            
            // Atualizar o cabe√ßalho
            const header = document.getElementById('mainHeader');
            header.innerHTML = `
                <h1><i class="fas fa-calendar-alt"></i> Agendamento Mundo Carol</h1>
            `;
            
            // Atualizar resumo imediatamente
            updateProductsSummary();
        }
        
        function showExpiredMessage() {
            document.getElementById('expiredMessage').classList.remove('hidden');
            document.querySelectorAll('.form-page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('productsSummary').style.display = 'none';
            document.getElementById('progressIndicator').style.display = 'none';
        }
        
        function contactWhatsApp() {
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=Ol√°! Recebi um link expirado e preciso de um novo link para fazer um pedido.`, '_blank');
        }
        
        // ============================================
        // FUN√á√ïES AUXILIARES
        // ============================================
        function setupCardSection() {
            // Configurar eventos para cart√£o j√° foram configurados em setupFormInputListeners
        }
        
        function getTotalWithShipping() {
            const { total } = getAllProducts();
            let finalTotal = total;
            
            // Adicionar frete se for entrega
            if (currentDeliveryType === 'delivery' && !isOtherCity) {
                finalTotal += calculatedShipping;
            }
            
            // Adicionar taxa noturna
            finalTotal += (nightFeeAmount || 0);
            
            return finalTotal;
        }
        
        function getShippingForSpreadsheet() {
            let totalShipping = 0;
            
            // Adicionar frete se for entrega
            if (currentDeliveryType === 'delivery' && !isOtherCity) {
                totalShipping += calculatedShipping;
            }
            
            // Adicionar taxa noturna
            totalShipping += (nightFeeAmount || 0);
            
            return totalShipping;
        }
        
        // ============================================
        // VALIDA√á√ÉO
        // ============================================
        function validatePage(page) {
            const errors = [];
            
            if (page === 1) {
                const { products } = getAllProducts();
                
                // Se veio de link, j√° tem produtos pr√©-selecionados
                if (!isFromLink && products.length === 0) {
                    errors.push({ field: 'products', message: 'Adicione pelo menos um produto' });
                }
                
                // Verificar cada produto (s√≥ se n√£o veio de link)
                if (!isFromLink) {
                    products.forEach((product, index) => {
                        if (!product.name || product.name.trim() === '') {
                            errors.push({ field: `productName${index + 1}`, message: 'Descri√ß√£o obrigat√≥ria' });
                        }
                        if (!product.price || product.price <= 0) {
                            errors.push({ field: `productPrice${index + 1}`, message: 'Pre√ßo obrigat√≥rio' });
                        }
                    });
                }
                
                if (!document.getElementById('buyerName').value.trim()) {
                    errors.push({ field: 'buyerName', message: 'Nome do comprador obrigat√≥rio' });
                }
                
                if (!document.getElementById('buyerPhone').value.trim()) {
                    errors.push({ field: 'buyerPhone', message: 'Telefone obrigat√≥rio' });
                }
                
                if (!document.getElementById('giftedName').value.trim()) {
                    errors.push({ field: 'giftedName', message: 'Nome do presenteado obrigat√≥rio' });
                }
                
                if (!document.getElementById('giftedPhone').value.trim()) {
                    errors.push({ field: 'giftedPhone', message: 'Telefone do presenteado obrigat√≥rio' });
                }
                
                if (!document.querySelector('input[name="deliveryType"]:checked')) {
                    errors.push({ field: 'deliveryType', message: 'Selecione o tipo de entrega' });
                }
                
            } else if (page === 2) {
                const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
                
                if (deliveryType === 'delivery') {
                    const city = document.getElementById('deliveryCity').value;
                    if (!city) {
                        errors.push({ field: 'deliveryCity', message: 'Selecione a cidade' });
                    }
                    
                    if (city !== 'other') {
                        if (!document.getElementById('street').value.trim()) {
                            errors.push({ field: 'street', message: 'Rua obrigat√≥ria' });
                        }
                        
                        if (!document.getElementById('number').value.trim()) {
                            errors.push({ field: 'number', message: 'N√∫mero obrigat√≥rio' });
                        }
                        
                        if (!document.getElementById('neighborhood').value.trim()) {
                            errors.push({ field: 'neighborhood', message: 'Bairro obrigat√≥rio' });
                        }
                    }
                }
                
            } else if (page === 3) {
                const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
                
                if (deliveryType === 'pickup') {
                    if (!selectedDate) {
                        errors.push({ field: 'deliveryTime', message: 'Selecione uma data' });
                    }
                    
                    if (!document.querySelector('input[name="deliveryTime"]:checked')) {
                        errors.push({ field: 'deliveryTime', message: 'Selecione um hor√°rio' });
                    }
                } else {
                    const city = document.getElementById('deliveryCity').value;
                    if (city !== 'other') {
                        if (!selectedDate) {
                            errors.push({ field: 'deliveryTime', message: 'Selecione uma data' });
                        }
                        
                        if (!document.querySelector('input[name="deliveryTime"]:checked')) {
                            errors.push({ field: 'deliveryTime', message: 'Selecione um hor√°rio' });
                        }
                    }
                }
                
            } else if (page === 4) {
                if (!document.querySelector('input[name="sendCard"]:checked')) {
                    errors.push({ field: 'sendCard', message: 'Selecione se quer cart√£o' });
                }
                
                const sendCard = document.querySelector('input[name="sendCard"]:checked')?.value;
                if (sendCard === 'yes') {
                    if (!document.getElementById('cardMessage').value.trim()) {
                        errors.push({ field: 'cardMessage', message: 'Mensagem do cart√£o obrigat√≥ria' });
                    }
                    
                    if (!document.querySelector('input[name="acknowledgeTerms"]:checked')) {
                        errors.push({ field: 'acknowledgeTerms', message: 'Aceite o Termo de Ci√™ncia' });
                    }
                    
                    if (!document.querySelector('input[name="signedCard"]:checked')) {
                        errors.push({ field: 'signedCard', message: 'Confirme sobre assinatura' });
                    }
                    
                    if (!document.querySelector('input[name="anonymous"]:checked')) {
                        errors.push({ field: 'anonymous', message: 'Selecione se quer an√¥nimo' });
                    }
                    
                    const anonymous = document.querySelector('input[name="anonymous"]:checked')?.value;
                    if (anonymous === 'yes') {
                        if (!document.getElementById('anonymousNotesText').value.trim()) {
                            errors.push({ field: 'anonymousNotesText', message: 'Observa√ß√µes do anonimato obrigat√≥rias' });
                        }
                    }
                } else {
                    // N√£o quer cart√£o, mas precisa responder sobre anonimato
                    if (!document.querySelector('input[name="anonymousNoCard"]:checked')) {
                        errors.push({ field: 'anonymousNoCard', message: 'Selecione se quer an√¥nimo' });
                    }
                    
                    const anonymous = document.querySelector('input[name="anonymousNoCard"]:checked')?.value;
                    if (anonymous === 'yes') {
                        if (!document.getElementById('anonymousNotesTextNoCard').value.trim()) {
                            errors.push({ field: 'anonymousNotesTextNoCard', message: 'Observa√ß√µes do anonimato obrigat√≥rias' });
                        }
                    }
                }
                
            } else if (page === 5) {
                if (!document.querySelector('input[name="paymentMethod"]:checked')) {
                    errors.push({ field: 'paymentMethod', message: 'Selecione a forma de pagamento' });
                }
                
                if (!document.querySelector('input[name="foundUs"]:checked')) {
                    errors.push({ field: 'foundUs', message: 'Nos informe como nos encontrou' });
                }
            }
            
            return {
                valid: errors.length === 0,
                errors: errors
            };
        }
        
        function showErrors(errors) {
            errors.forEach(error => {
                const field = document.getElementById(error.field);
                const errorElement = document.getElementById(`error${error.field.charAt(0).toUpperCase() + error.field.slice(1)}`);
                
                if (field) {
                    field.classList.add('field-error');
                    
                    // Rolar at√© o primeiro erro
                    if (errors[0] === error) {
                        field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
                
                if (errorElement) {
                    errorElement.textContent = error.message;
                    errorElement.classList.add('show');
                }
            });
        }
        
        function clearErrors() {
            // Remover classes de erro
            document.querySelectorAll('.field-error').forEach(el => {
                el.classList.remove('field-error');
            });
            
            // Esconder mensagens de erro
            document.querySelectorAll('.error-text').forEach(el => {
                el.classList.remove('show');
            });
        }
        
        // ============================================
        // REVIS√ÉO DE DADOS
        // ============================================
        function updateReviewData() {
            const reviewDiv = document.getElementById('reviewData');
            const totalSection = document.getElementById('finalTotalSection');
            const totalDetails = document.getElementById('finalTotalDetails');
            
            let html = '';
            let totalHtml = '';
            
            const formatCurrency = (value) => {
                return parseFloat(value || 0).toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
            };
            
            const formatDate = (date) => {
                return date.toLocaleDateString('pt-BR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            };
            
            // Produtos
            const { products, total } = getAllProducts();
            
            html += '<div class="review-item">';
            html += '<div class="review-label">Produtos</div>';
            html += '<div class="review-value">';
            products.forEach((product, index) => {
                html += `${product.quantity}x ${product.code ? product.code + ' - ' : ''}${product.name}<br>`;
            });
            html += '</div>';
            html += '</div>';
            
            // Valores
            const finalTotal = getTotalWithShipping();
            
            totalHtml += '<div class="total-item">';
            totalHtml += '<span>Valor dos Produtos:</span>';
            totalHtml += `<span>${formatCurrency(total)}</span>`;
            totalHtml += '</div>';
            
            // Frete
            if (currentDeliveryType === 'delivery' && !isOtherCity && calculatedShipping > 0) {
                html += '<div class="review-item">';
                html += '<div class="review-label">Frete</div>';
                html += `<div class="review-value">${formatCurrency(calculatedShipping)}</div>`;
                html += '</div>';
                
                totalHtml += '<div class="total-item">';
                totalHtml += '<span>Frete:</span>';
                totalHtml += `<span>${formatCurrency(calculatedShipping)}</span>`;
                totalHtml += '</div>';
            }
            
            // Taxas
            if (nightFeeAmount > 0) {
                html += '<div class="review-item">';
                html += '<div class="review-label taxa-label">Taxa Noturna/Domingo</div>';
                html += `<div class="review-value taxa-item">${formatCurrency(nightFeeAmount)}</div>`;
                html += '</div>';
                
                totalHtml += '<div class="total-item">';
                totalHtml += '<span class="taxa-label">Taxa Noturna/Domingo:</span>';
                totalHtml += `<span class="taxa-item">${formatCurrency(nightFeeAmount)}</span>`;
                totalHtml += '</div>';
            }
            
            // Dados pessoais
            html += '<div class="review-item">';
            html += '<div class="review-label">Comprador</div>';
            html += `<div class="review-value">${document.getElementById('buyerName').value} - ${document.getElementById('buyerPhone').value}</div>`;
            html += '</div>';
            
            html += '<div class="review-item">';
            html += '<div class="review-label">Presenteado</div>';
            html += `<div class="review-value">${document.getElementById('giftedName').value}`;
            if (document.getElementById('giftedPhone').value) {
                html += ` - ${document.getElementById('giftedPhone').value}`;
            }
            html += '</div>';
            html += '</div>';
            
            // Entrega
            html += '<div class="review-item">';
            html += '<div class="review-label">Entrega</div>';
            if (currentDeliveryType === 'pickup') {
                html += '<div class="review-value">Retirada na loja (S√£o Geraldo - BH)</div>';
            } else if (isOtherCity) {
                html += '<div class="review-value">Outra cidade (prazo a confirmar)</div>';
            } else {
                const street = document.getElementById('street').value;
                const number = document.getElementById('number').value;
                html += `<div class="review-value">${street}, ${number}`;
                if (document.getElementById('complement').value) {
                    html += ` - ${document.getElementById('complement').value}`;
                }
                html += ` - ${document.getElementById('neighborhood').value}`;
                if (selectedCity) {
                    html += ` - ${selectedCity}`;
                }
                html += '</div>';
            }
            html += '</div>';
            
            // Data e hor√°rio
            if (selectedDate) {
                html += '<div class="review-item">';
                html += '<div class="review-label">Data e Hor√°rio</div>';
                html += `<div class="review-value">${formatDate(selectedDate)} - ${selectedTimeLabel || 'A definir'}</div>`;
                html += '</div>';
            }
            
            // Cart√£o
            const sendCard = document.querySelector('input[name="sendCard"]:checked')?.value;
            if (sendCard === 'yes') {
                html += '<div class="review-item">';
                html += '<div class="review-label">Cart√£o</div>';
                html += `<div class="review-value">${document.getElementById('cardMessage').value.substring(0, 50)}...</div>`;
                html += '</div>';
                
                const anonymous = document.querySelector('input[name="anonymous"]:checked')?.value;
                if (anonymous === 'yes') {
                    html += '<div class="review-item">';
                    html += '<div class="review-label">Compra An√¥nima</div>';
                    html += `<div class="review-value">Sim - ${document.getElementById('anonymousNotesText').value.substring(0, 50)}...</div>`;
                    html += '</div>';
                }
            } else {
                const anonymous = document.querySelector('input[name="anonymousNoCard"]:checked')?.value;
                if (anonymous === 'yes') {
                    html += '<div class="review-item">';
                    html += '<div class="review-label">Compra An√¥nima</div>';
                    html += `<div class="review-value">Sim - ${document.getElementById('anonymousNotesTextNoCard').value.substring(0, 50)}...</div>`;
                    html += '</div>';
                }
            }
            
            reviewDiv.innerHTML = html;
            
            // Total final
            totalHtml += '<div class="total-item total-final">';
            totalHtml += '<span><strong>TOTAL:</strong></span>';
            totalHtml += `<span><strong>${formatCurrency(finalTotal)}</strong></span>`;
            totalHtml += '</div>';
            
            totalDetails.innerHTML = totalHtml;
            totalSection.classList.remove('hidden');
        }
        
        // ============================================
        // ENVIO PARA PLANILHA
        // ============================================
        function prepareExcelData() {
            const now = new Date();
            const formattedDateTime = `${now.getDate().toString().padStart(2, '0')}/` +
                                     `${(now.getMonth() + 1).toString().padStart(2, '0')}/` +
                                     `${now.getFullYear()} ` +
                                     `${now.getHours().toString().padStart(2, '0')}:` +
                                     `${now.getMinutes().toString().padStart(2, '0')}`;
            
            const { products, total } = getAllProducts();
            const buyerName = document.getElementById('buyerName').value;
            const buyerPhone = document.getElementById('buyerPhone').value;
            const giftedName = document.getElementById('giftedName').value;
            const giftedPhone = document.getElementById('giftedPhone').value;
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
            const anonymous = document.querySelector('input[name="anonymous"]:checked')?.value || 
                             document.querySelector('input[name="anonymousNoCard"]:checked')?.value;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;
            const foundUs = document.querySelector('input[name="foundUs"]:checked')?.value;
            const sendCard = document.querySelector('input[name="sendCard"]:checked')?.value;
            const cardMessage = document.getElementById('cardMessage').value || '';
            const anonymousNotes = document.getElementById('anonymousNotesText').value || 
                                  document.getElementById('anonymousNotesTextNoCard').value || '';
            
            const formattedPrice = total.toFixed(2).replace('.', ',');
            
            // Formatar produtos para planilha
            let productsDescription = '';
            let kitsCount = 0;
            const productDetails = [];
            
            products.forEach(product => {
                kitsCount += product.quantity;
                productDetails.push(`${product.quantity}x ${product.code || ''} ${product.name}`);
            });
            
            const productSummary = `(${kitsCount} Kits ${products.map(p => `${p.quantity}x${p.code}`).join(' ')})`;
            const productDetailsStr = productDetails.join(' / ');
            productsDescription = `${productSummary} - ${productDetailsStr}`;
            
            // Frete + taxas
            const totalShipping = getShippingForSpreadsheet();
            const formattedShipping = totalShipping.toFixed(2).replace('.', ',');
            
            let streetNumber = '';
            let complement = '';
            let neighborhood = '';
            let city = '';
            let reference = '';
            
            if (deliveryType === 'delivery' && !isOtherCity) {
                const street = document.getElementById('street').value;
                const number = document.getElementById('number').value;
                streetNumber = `${street}, ${number}`;
                complement = document.getElementById('complement').value || '';
                neighborhood = document.getElementById('neighborhood').value;
                city = selectedCity;
                reference = document.getElementById('referencePoint').value || '';
            }
            
            let deliveryDate = '';
            if (selectedDate) {
                const days = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'S√°bado'];
                const dayName = days[selectedDate.getDay()];
                deliveryDate = `${selectedDate.getDate().toString().padStart(2, '0')}/` +
                              `${(selectedDate.getMonth() + 1).toString().padStart(2, '0')}/` +
                              `${selectedDate.getFullYear()} - ${dayName}`;
            }
            
            const sendCardText = sendCard === 'yes' ? 'Sim' : 'N√£o';
            const anonymousText = anonymous === 'yes' ? 'ANONIMO' : 'Sim';
            
            let paymentText = '';
            if (paymentMethod === 'pix') {
                paymentText = 'PIX direto para nosso CNPJ? (Vamos te enviar o link)';
            } else if (paymentMethod === 'creditCard') {
                paymentText = 'Link de Cart√£o Cr√©dito online (vamos te enviar o link)';
            }
            
            const data = new Array(52).fill('');
            
            data[0] = formattedDateTime;
            data[1] = buyerName;
            data[2] = buyerPhone;
            data[3] = productsDescription;
            data[4] = formattedPrice;
            data[5] = formattedShipping;
            data[6] = 'FORMUL√ÅRIO MANUAL';
            data[8] = giftedName;
            data[9] = giftedPhone;
            data[10] = streetNumber;
            data[11] = complement;
            data[12] = neighborhood;
            data[13] = city;
            data[14] = reference;
            data[15] = deliveryDate;
            data[16] = selectedTimeLabel || '';
            data[17] = sendCardText;
            
            if (sendCard === 'yes') {
                data[18] = cardMessage.replace(/\n/g, ' ');
            }
            
            if (anonymous === 'yes') {
                data[48] = 'ANONIMO';
                if (anonymousNotes) {
                    data[49] = anonymousNotes.replace(/\n/g, ' ');
                }
            } else {
                data[48] = 'Sim';
            }
            
            data[46] = foundUs || '';
            data[32] = paymentText;
            
            // Adicionar link ID na coluna 51
            data[51] = linkId || '';
            
            return data;
        }
        
        async function submitForm() {
            if (isSubmitting) return;
            
            const validation = validatePage(6);
            if (!validation.valid) {
                showErrors(validation.errors);
                showToast('Corrija os erros antes de enviar', 'warning');
                return;
            }
            
            // Marcar link como usado
            if (isFromLink && linkId) {
                const usedLinks = JSON.parse(localStorage.getItem('mundoCarol_used_links') || '[]');
                usedLinks.push(linkId);
                localStorage.setItem('mundoCarol_used_links', JSON.stringify(usedLinks));
            }
            
            const submitBtn = document.getElementById('submitButton');
            const loadingSection = document.getElementById('loadingSection');
            
            submitBtn.disabled = true;
            isSubmitting = true;
            loadingSection.style.display = 'block';
            
            try {
                const excelData = prepareExcelData();
                
                const result = await enviarDadosParaPlanilha(excelData);
                
                if (result.success) {
                    submitBtn.innerHTML = '‚úÖ ENVIADO';
                    submitBtn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        document.getElementById('page6').classList.remove('active');
                        
                        const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value;
                        if (paymentMethod === 'pix') {
                            document.getElementById('thankYouPagePix').classList.add('active');
                            showPaymentConfirmation('pix');
                        } else {
                            document.getElementById('thankYouPageCard').classList.add('active');
                            showPaymentConfirmation('card');
                        }
                        
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 1000);
                    
                    // Limpar localStorage ap√≥s envio bem-sucedido
                    setTimeout(() => {
                        const storageKey = isFromLink ? 'mundoCarolFormData_link' : 'mundoCarolFormData';
                        localStorage.removeItem(storageKey);
                        console.log('üóëÔ∏è Dados limpos ap√≥s envio');
                    }, 5000);
                    
                } else {
                    throw new Error(result.message || 'Erro desconhecido');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no envio:', error);
                showToast(`Erro: ${error.message || 'Falha na conex√£o'}`, 'warning');
                submitBtn.disabled = false;
                isSubmitting = false;
            } finally {
                loadingSection.style.display = 'none';
            }
        }
        
        async function enviarDadosParaPlanilha(dados) {
            try {
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(WEB_APP_URL)}`;
                
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'inserir_pedido',
                        senha: CORRECT_PASSWORD,
                        dados: dados
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                return {
                    success: data.status === 'sucesso',
                    message: data.message || 'Dados enviados com sucesso!'
                };
                
            } catch (error) {
                console.error('‚ùå Erro:', error);
                
                try {
                    const resultAlt = await enviarDadosAlternativo(dados);
                    return resultAlt;
                } catch (altError) {
                    throw altError;
                }
            }
        }
        
        async function enviarDadosAlternativo(dados) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve({
                        success: true,
                        message: 'Dados enviados - Verifique a planilha'
                    });
                }, 1500);
            });
        }
        
        // ============================================
        // P√ÅGINAS DE SUCESSO
        // ============================================
        function showPaymentConfirmation(type) {
            const buyerName = document.getElementById('buyerName').value;
            const paymentDetailsDiv = type === 'pix' ? document.getElementById('paymentDetails') : document.getElementById('paymentDetailsCard');
            
            const formatCurrency = (value) => {
                return parseFloat(value || 0).toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
            };
            
            let html = '';
            
            html += '<div class="review-item">';
            html += '<div class="review-label">Cliente</div>';
            html += `<div class="review-value">${buyerName}</div>`;
            html += '</div>';
            
            const { products, total } = getAllProducts();
            
            html += '<div class="review-item">';
            html += '<div class="review-label">Produtos</div>';
            html += '<div class="review-value">';
            products.forEach((product, index) => {
                html += `${product.quantity}x ${product.code ? product.code + ' - ' : ''}${product.name}<br>`;
            });
            html += '</div>';
            html += '</div>';
            
            const totalShipping = getShippingForSpreadsheet();
            const finalTotal = getTotalWithShipping();
            
            html += '<div class="review-item">';
            html += '<div class="review-label">Valor Produtos</div>';
            html += `<div class="review-value">${formatCurrency(total)}</div>`;
            html += '</div>';
            
            if (totalShipping > 0) {
                html += '<div class="review-item">';
                html += '<div class="review-label">Frete + Taxas</div>';
                html += `<div class="review-value">${formatCurrency(totalShipping)}</div>`;
                html += '</div>';
            }
            
            html += '<div class="review-item total-final">';
            html += '<div class="review-label"><strong>TOTAL</strong></div>';
            html += `<div class="review-value"><strong>${formatCurrency(finalTotal)}</strong></div>`;
            html += '</div>';
            
            paymentDetailsDiv.innerHTML = html;
        }
        
        function copyPixKey() {
            const pixKey = PIX_KEY;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(pixKey).then(() => {
                    document.getElementById('pixCopySuccess').textContent = '‚úÖ Chave PIX copiada com sucesso!';
                    document.getElementById('pixCopySuccess').classList.add('show');
                    if (document.getElementById('pixCopySuccess2')) {
                        document.getElementById('pixCopySuccess2').textContent = '‚úÖ Chave PIX copiada com sucesso!';
                        document.getElementById('pixCopySuccess2').classList.add('show');
                    }
                    
                    setTimeout(() => {
                        document.getElementById('pixCopySuccess').classList.remove('show');
                        if (document.getElementById('pixCopySuccess2')) {
                            document.getElementById('pixCopySuccess2').classList.remove('show');
                        }
                    }, 3000);
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = pixKey;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                document.getElementById('pixCopySuccess').textContent = '‚úÖ Chave PIX copiada com sucesso!';
                document.getElementById('pixCopySuccess').classList.add('show');
                if (document.getElementById('pixCopySuccess2')) {
                    document.getElementById('pixCopySuccess2').textContent = '‚úÖ Chave PIX copiada com sucesso!';
                    document.getElementById('pixCopySuccess2').classList.add('show');
                }
                
                setTimeout(() => {
                    document.getElementById('pixCopySuccess').classList.remove('show');
                    if (document.getElementById('pixCopySuccess2')) {
                        document.getElementById('pixCopySuccess2').classList.remove('show');
                    }
                }, 3000);
            }
        }
        
        function sendWhatsAppMessage(paymentType) {
            const buyerName = document.getElementById('buyerName').value;
            const buyerPhone = document.getElementById('buyerPhone').value;
            const { products } = getAllProducts();
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value;
            
            let message = `*NOVO PEDIDO - Mundo Carol*%0A%0A`;
            message += `*Cliente:* ${buyerName}%0A`;
            message += `*Telefone:* ${buyerPhone}%0A`;
            message += `*Produtos:*%0A`;
            
            products.forEach((product, index) => {
                message += `${product.quantity}x ${product.code ? product.code + ' - ' : ''}${product.name}%0A`;
            });
            
            if (deliveryType === 'delivery' && !isOtherCity && selectedCity) {
                message += `*Cidade:* ${selectedCity}%0A`;
            } else if (deliveryType === 'delivery' && isOtherCity) {
                message += `*Cidade:* Outra cidade%0A`;
            } else if (deliveryType === 'pickup') {
                message += `*Cidade:* Retirada BH%0A`;
            }
            
            if (selectedDate && selectedTimeLabel) {
                const formattedDate = selectedDate.toLocaleDateString('pt-BR');
                message += `*Data:* ${formattedDate}%0A`;
                message += `*Hor√°rio:* ${selectedTimeLabel}%0A`;
            }
            
            if (paymentType === 'pix') {
                message += `*Pagamento:* PIX%0A`;
            } else if (paymentType === 'card') {
                message += `*Pagamento:* Cart√£o de Cr√©dito%0A`;
            }
            
            message += `%0AFormul√°rio enviado com sucesso!`;
            
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${message}`, '_blank');
        }
        
        // ============================================
        // FUN√á√ïES DE UTILIDADE
        // ============================================
        function copyToClipboard(text, type) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    if (type === 'link') {
                        showToast('Link copiado para a √°rea de transfer√™ncia!', 'success');
                    }
                }).catch(err => {
                    copyUsingExecCommand(text, type);
                });
            } else {
                copyUsingExecCommand(text, type);
            }
        }
        
        function copyUsingExecCommand(text, type) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                if (type === 'link') {
                    showToast('Link copiado para a √°rea de transfer√™ncia!', 'success');
                }
            } catch (err) {
                showToast('‚ö†Ô∏è N√£o foi poss√≠vel copiar. Por favor, anote: ' + text.substring(0, 50) + '...', 'warning');
            } finally {
                document.body.removeChild(textArea);
            }
        }
        
        function showToast(message, type = 'warning') {
            const toast = document.getElementById('toastNotification');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast-notification';
            toast.classList.add(type);
            toast.classList.remove('hidden');
            
            // Auto-fechar ap√≥s 5 segundos
            setTimeout(() => {
                closeToast();
            }, 5000);
        }
        
        function closeToast() {
            document.getElementById('toastNotification').classList.add('hidden');
        }
        
        function setupSilentAutosave() {
            // J√° configurado nos event listeners
        }
    </script>
</body>
</html>
